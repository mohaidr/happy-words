<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Google Analytics -->
    <script src="../js/analytics.js"></script>
    <script src="../js/i18n.js"></script>
    <title>Opposite Match â†”ï¸</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Baloo+Bhaijaan+2:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/games.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
        
        .game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
            background-color: rgb(255 255 255 / 50%);
            
        }
        
        .word-prompt {
            background: linear-gradient(145deg, #fdcb6e, #f39c12);
            padding: 25px 60px;
            border-radius: 20px;
            font-size: 42px;
            font-weight: bold;
            color: #2d3436;
            box-shadow: 0 8px 25px rgba(0,0,0,0.25);
            min-width: 180px;
            text-align: center;
            display: inline-block;
            border: 4px solid rgba(255,255,255,0.3);
        }
        
        .question-text {
            font-size: 20px;
            opacity: 0.95;
            margin-bottom: 5px;
        }
        
        .answer-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            width: 100%;
            max-width: 350px;
        }
        
        .answer-btn {
            padding: 22px 15px;
            font-size: 26px;
            font-family: inherit;
            font-weight: 700;
            border: none;
            border-radius: 18px;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
            min-height: 85px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }
        
        .answer-btn:nth-child(1) { background: linear-gradient(145deg, #74b9ff, #0984e3); }
        .answer-btn:nth-child(2) { background: linear-gradient(145deg, #00b894, #00cec9); }
        .answer-btn:nth-child(3) { background: linear-gradient(145deg, #fd79a8, #e84393); }
        .answer-btn:nth-child(4) { background: linear-gradient(145deg, #a29bfe, #6c5ce7); }
        
        .answer-btn:hover {
            transform: translateY(-4px) scale(1.03);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .answer-btn:active {
            transform: scale(0.98);
        }
        
        .answer-btn.correct {
            background: linear-gradient(145deg, #00b894, #00cec9) !important;
            animation: correctPop 0.4s ease;
        }
        
        .answer-btn.wrong {
            background: linear-gradient(145deg, #d63031, #e74c3c) !important;
            animation: shake 0.4s ease;
        }
        
        @keyframes correctPop {
            50% { transform: scale(1.15); }
        }
        
        .streak-bonus {
            background: rgba(255,255,255,0.25);
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: 600;
        }
        
        .streak-bonus.hot {
            background: linear-gradient(145deg, #ff6b6b, #ee5a24);
            animation: pulse 1s ease infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        #gameOver h2 { color: #6c5ce7; }
    </style>
</head>
<body>
    <div class="top-bar">
        <a href="../home.html" class="home-btn" data-i18n="game.home">â† Home</a>
        <a href="category-reading.html" class="category-btn" data-i18n="nav.reading">ğŸ“š Reading</a>
        <h1 data-i18n="oppositeMatch.title">â†”ï¸ Opposite Match</h1>
    </div>
    
    <div class="stats">
        <div><span data-i18n="game.score">Score</span>: <span id="score">0</span></div>
        <div><span data-i18n="game.level">Level</span>: <span id="level">1</span></div>
        <div>â¤ï¸ <span id="lives">3</span></div>
    </div>
    
    <div class="game-area">
        <div class="streak-bonus" id="streakBonus">ğŸ”¥ Streak: 0</div>
        
        <p class="question-text" data-i18n="oppositeMatch.instruction">What is the OPPOSITE of...</p>
        
        <div class="word-prompt" id="wordPrompt"></div>
        
        <div class="answer-grid" id="answerGrid"></div>
    </div>
    
    <div id="gameOver">
        <h2 data-i18n="oppositeMatch.result">ğŸ‰ Great Job!</h2>
        <p id="playerDisplay"></p>
        <p><span data-i18n="game.finalScoreLabel">Final Score</span>: <span id="finalScore">0</span></p>
        <p>ğŸ† <span data-i18n="game.highScore">High Score</span>: <span id="highScore">0</span></p>
        <p><span data-i18n="game.bestStreak">Best Streak</span>: <span id="bestStreak">0</span></p>
        <button class="btn" onclick="startGame()" data-i18n="game.playAgain">Play Again</button>
        <a href="../home.html" class="home-link">â† Back to Home</a>
    </div>
    
    <p class="info" data-i18n="oppositeMatch.hint">Find the word that means the opposite!</p>

    <script src="../js/game-utils.js"></script>
    <script>
        const GAME_KEY = 'oppositeMatch';
        
        // English opposite pairs by difficulty (kid-friendly)
        const oppositesEn = {
            easy: [
                ['hot', 'cold'], ['big', 'small'], ['up', 'down'],
                ['happy', 'sad'], ['fast', 'slow'], ['day', 'night'],
                ['old', 'young'], ['open', 'close'], ['in', 'out'],
                ['yes', 'no'], ['stop', 'go'], ['boy', 'girl'],
                ['tall', 'short'], ['wet', 'dry'], ['full', 'empty'],
                ['light', 'dark'], ['soft', 'hard'], ['clean', 'dirty'],
                ['loud', 'quiet'], ['push', 'pull'], ['top', 'bottom'],
                ['new', 'old'], ['good', 'bad'], ['left', 'right'],
                ['high', 'low'], ['here', 'there'], ['come', 'go'],
                ['sit', 'stand'], ['run', 'walk'], ['sleep', 'wake'],
                ['front', 'back'], ['near', 'far'], ['first', 'last'],
                ['on', 'off'], ['black', 'white'], ['sun', 'moon'],
                ['add', 'subtract'], ['over', 'under'], ['inside', 'outside'],
                ['before', 'after'], ['above', 'below'], ['buy', 'sell'],
                ['ask', 'answer'], ['many', 'few'], ['more', 'less'],
                ['same', 'different'], ['early', 'late'], ['start', 'finish'],
                ['lost', 'found'], ['hide', 'seek'], ['nice', 'unkind'],
                ['sink', 'float'], ['thin', 'thick'], ['warm', 'cool'],
            ],
            medium: [
                ['brave', 'scared'], ['kind', 'unkind'], ['strong', 'weak'],
                ['sweet', 'sour'], ['thick', 'thin'], ['laugh', 'cry'],
                ['heavy', 'light'], ['rough', 'smooth'], ['sharp', 'dull'],
                ['deep', 'shallow'], ['wide', 'narrow'], ['loose', 'tight'],
                ['wild', 'tame'], ['asleep', 'awake'], ['begin', 'end'],
                ['noisy', 'quiet'], ['win', 'lose'], ['give', 'take'],
                ['remember', 'forget'], ['true', 'false'], ['calm', 'upset'],
                ['bright', 'dim'], ['wise', 'silly'], ['tidy', 'messy'],
                ['lazy', 'busy'], ['proud', 'shy'], ['plain', 'fancy'],
                ['fresh', 'stale'], ['ripe', 'unripe'], ['whole', 'broken'],
                ['real', 'fake'], ['common', 'rare'], ['cheap', 'expensive'],
                ['easy', 'hard'], ['simple', 'complex'], ['boring', 'fun'],
                ['gentle', 'rough'], ['major', 'minor'], ['public', 'private'],
                ['normal', 'unusual'], ['silent', 'loud'], ['polite', 'rude'],
                ['lucky', 'unlucky'], ['careful', 'careless'], ['useful', 'useless'],
                ['possible', 'impossible'], ['visible', 'invisible'], ['active', 'inactive'],
                ['indoor', 'outdoor'], ['sunny', 'cloudy'], ['empty', 'crowded'],
            ],
            hard: [
                ['ancient', 'modern'], ['arrive', 'depart'], ['boring', 'exciting'],
                ['certain', 'doubtful'], ['combine', 'separate'], ['expand', 'shrink'],
                ['generous', 'selfish'], ['maximum', 'minimum'], ['permanent', 'temporary'],
                ['positive', 'negative'], ['success', 'failure'], ['accept', 'reject'],
                ['include', 'exclude'], ['artificial', 'natural'], ['amateur', 'professional'],
                ['abstract', 'concrete'], ['voluntary', 'required'], ['frequent', 'rare'],
                ['gradual', 'sudden'], ['humble', 'proud'], ['abundant', 'scarce'],
                ['flexible', 'rigid'], ['transparent', 'opaque'], ['external', 'internal'],
                ['vertical', 'horizontal'], ['majority', 'minority'], ['optimistic', 'pessimistic'],
                ['increase', 'decrease'], ['complex', 'simple'], ['familiar', 'strange'],
                ['confident', 'nervous'], ['approve', 'disapprove'], ['encourage', 'discourage'],
                ['entrance', 'exit'], ['genuine', 'fake'], ['logical', 'illogical'],
                ['precious', 'worthless'], ['ordinary', 'extraordinary'], ['patient', 'impatient'],
                ['organized', 'disorganized'], ['popular', 'unpopular'], ['regular', 'irregular'],
                ['specific', 'general'], ['temporary', 'permanent'], ['willing', 'unwilling'],
            ]
        };
        
        // Arabic opposite pairs (Ø§Ù„Ø£Ø¶Ø¯Ø§Ø¯) - kid-friendly from curated list
        const oppositesAr = {
            easy: [
                ['ÙƒØ¨ÙŠØ±', 'ØµØºÙŠØ±'], ['Ø·ÙˆÙŠÙ„', 'Ù‚ØµÙŠØ±'], ['Ù‚ÙˆÙŠ', 'Ø¶Ø¹ÙŠÙ'],
                ['Ø³Ø±ÙŠØ¹', 'Ø¨Ø·ÙŠØ¡'], ['ÙˆØ§Ø³Ø¹', 'Ø¶ÙŠÙ‚'], ['Ø«Ù‚ÙŠÙ„', 'Ø®ÙÙŠÙ'],
                ['Ù‚Ø¯ÙŠÙ…', 'Ø¬Ø¯ÙŠØ¯'], ['ØµØ¹Ø¨', 'Ø³Ù‡Ù„'], ['ÙƒØ«ÙŠØ±', 'Ù‚Ù„ÙŠÙ„'],
                ['Ø¨Ø¹ÙŠØ¯', 'Ù‚Ø±ÙŠØ¨'], ['Ù†Ø¸ÙŠÙ', 'Ù…ØªØ³Ø®'], ['Ø³Ø¹ÙŠØ¯', 'Ø­Ø²ÙŠÙ†'],
                ['Ù†Ø´ÙŠØ·', 'ÙƒØ³Ù„Ø§Ù†'], ['Ù‡Ø§Ø¯Ø¦', 'Ù…Ø²Ø¹Ø¬'], ['Ù†Ù‡Ø§Ø±', 'Ù„ÙŠÙ„'],
                ['ØµØ¨Ø§Ø­', 'Ù…Ø³Ø§Ø¡'], ['Ø¨Ø¯Ø§ÙŠØ©', 'Ù†Ù‡Ø§ÙŠØ©'], ['Ø£ÙˆÙ„', 'Ø¢Ø®Ø±'],
                ['Ù‚Ø¨Ù„', 'Ø¨Ø¹Ø¯'], ['ÙÙˆÙ‚', 'ØªØ­Øª'], ['Ø£Ù…Ø§Ù…', 'Ø®Ù„Ù'],
                ['ÙŠÙ…ÙŠÙ†', 'ÙŠØ³Ø§Ø±'], ['Ø¯Ø§Ø®Ù„', 'Ø®Ø§Ø±Ø¬'], ['Ù‡Ù†Ø§', 'Ù‡Ù†Ø§Ùƒ'],
                ['Ø´Ù…Ø³', 'Ù‚Ù…Ø±'], ['Ù†ÙˆØ±', 'Ø¸Ù„Ø§Ù…'], ['Ø­Ø±', 'Ø¨Ø±Ø¯'],
                ['Ø±Ø·Ø¨', 'Ø¬Ø§Ù'], ['Ø°Ù‡Ø¨', 'Ø¬Ø§Ø¡'], ['Ø¯Ø®Ù„', 'Ø®Ø±Ø¬'],
                ['ØµØ¹Ø¯', 'Ù†Ø²Ù„'], ['ÙˆÙ‚Ù', 'Ø¬Ù„Ø³'], ['Ù†Ø§Ù…', 'Ø§Ø³ØªÙŠÙ‚Ø¸'],
                ['ÙØªØ­', 'Ø£ØºÙ„Ù‚'], ['Ø£Ø¹Ø·Ù‰', 'Ø£Ø®Ø°'], ['Ø¶Ø­Ùƒ', 'Ø¨ÙƒÙ‰'],
                ['Ù†Ø³ÙŠ', 'ØªØ°ÙƒØ±'], ['Ø´Ø¨Ø¹Ø§Ù†', 'Ø¬Ø§Ø¦Ø¹'], ['Ù…Ø¨ÙƒØ±', 'Ù…ØªØ£Ø®Ø±'],
            ],
            medium: [
                ['Ø¬Ù…ÙŠÙ„', 'Ù‚Ø¨ÙŠØ­'], ['Ø³Ù…ÙŠÙ†', 'Ù†Ø­ÙŠÙ'], ['Ù…Ø±ØªÙØ¹', 'Ù…Ù†Ø®ÙØ¶'],
                ['Ø´Ø¬Ø§Ø¹', 'Ø®Ø§Ø¦Ù'], ['ÙƒØ±ÙŠÙ…', 'Ø¨Ø®ÙŠÙ„'], ['Ù…ØªÙˆØ§Ø¶Ø¹', 'Ù…ØªÙƒØ¨Ø±'],
                ['Ù„Ø·ÙŠÙ', 'ÙØ¸'], ['Ù…ØªÙØ§Ø¦Ù„', 'Ù…ØªØ´Ø§Ø¦Ù…'], ['ØµØ¨ÙˆØ±', 'Ø¬Ø²ÙˆØ¹'],
                ['Ø´Ø±ÙˆÙ‚', 'ØºØ±ÙˆØ¨'], ['Ù…Ø§Ø¶ÙŠ', 'Ù…Ø³ØªÙ‚Ø¨Ù„'], ['Ø´Ø±Ù‚', 'ØºØ±Ø¨'],
                ['Ø´Ù…Ø§Ù„', 'Ø¬Ù†ÙˆØ¨'], ['Ø³Ù…Ø§Ø¡', 'Ø£Ø±Ø¶'], ['Ø¨Ø­Ø±', 'Ø¨Ø±'],
                ['Ø¬Ø¨Ù„', 'ÙˆØ§Ø¯ÙŠ'], ['Ø¹Ø°Ø¨', 'Ù…Ø§Ù„Ø­'], ['ØµØ§ÙÙŠ', 'Ø¹ÙƒØ±'],
                ['ÙŠØ§Ø¨Ø³', 'Ø·Ø±ÙŠ'], ['Ø¨Ø§Ø¹', 'Ø§Ø´ØªØ±Ù‰'], ['Ø±Ø¨Ø­', 'Ø®Ø³Ø±'],
                ['Ù†Ø¬Ø­', 'Ø±Ø³Ø¨'], ['Ø¸Ø§Ù‡Ø±', 'Ø®ÙÙŠ'], ['Ø¹Ø§Ù…', 'Ø®Ø§Øµ'],
                ['Ù…ÙÙŠØ¯', 'ØºÙŠØ± Ù…ÙÙŠØ¯'], ['Ø«Ø§Ø¨Øª', 'Ù…ØªØºÙŠØ±'], ['Ù…Ù…ÙƒÙ†', 'Ù…Ø³ØªØ­ÙŠÙ„'],
                ['Ø±ÙŠØ§Ù†', 'Ø¹Ø·Ø´Ø§Ù†'], ['Ù…Ø³ØªÙ‚ÙŠÙ…', 'Ù…Ù†Ø­Ù†ÙŠ'], ['Ø¨Ø³ÙŠØ·', 'Ù…Ø±ÙƒØ¨'],
                ['ÙˆØ§Ù‚Ø¹ÙŠ', 'Ø®ÙŠØ§Ù„ÙŠ'], ['ØµØ§Ø¯Ù‚', 'ØºÙŠØ± ØµØ§Ø¯Ù‚'], ['Ø²Ø±Ø¹', 'Ø­ØµØ¯'],
            ],
            hard: [
                ['Ù…Ø¹Ù„ÙˆÙ…', 'Ù…Ø¬Ù‡ÙˆÙ„'], ['ÙˆØ§Ø­Ø¯', 'Ù…ØªØ¹Ø¯Ø¯'], ['Ù…Ø§Ø¯ÙŠ', 'Ù…Ø¹Ù†ÙˆÙŠ'],
                ['ÙƒÙ„ÙŠ', 'Ø¬Ø²Ø¦ÙŠ'], ['ØµØ­Ø©', 'Ù…Ø±Ø¶'], ['Ø¹Ù„Ù…', 'Ø¬Ù‡Ù„'],
                ['ÙˆØ¬ÙˆØ¯', 'Ø¹Ø¯Ù…'], ['Ø³Ù„Ø³', 'Ù…Ø¹Ù‚Ø¯'], ['Ø¸Ø§Ù‡Ø±', 'Ø¨Ø§Ø·Ù†'],
                ['Ø¯Ø§Ø¦Ù…', 'Ù…Ø¤Ù‚Øª'], ['Ø¥ÙŠØ¬Ø§Ø¨ÙŠ', 'Ø³Ù„Ø¨ÙŠ'], ['Ù†Ø¬Ø§Ø­', 'ÙØ´Ù„'],
                ['Ù‚Ø¨ÙˆÙ„', 'Ø±ÙØ¶'], ['ØµÙ†Ø§Ø¹ÙŠ', 'Ø·Ø¨ÙŠØ¹ÙŠ'], ['Ù‡Ø§ÙˆÙŠ', 'Ù…Ø­ØªØ±Ù'],
                ['Ù…ØªÙƒØ±Ø±', 'Ù†Ø§Ø¯Ø±'], ['ØªØ¯Ø±ÙŠØ¬ÙŠ', 'Ù…ÙØ§Ø¬Ø¦'], ['ÙˆÙÙŠØ±', 'Ø´Ø­ÙŠØ­'],
                ['Ù…Ø±Ù†', 'ØµÙ„Ø¨'], ['Ø´ÙØ§Ù', 'Ù…Ø¹ØªÙ…'], ['Ø®Ø§Ø±Ø¬ÙŠ', 'Ø¯Ø§Ø®Ù„ÙŠ'],
                ['Ø¹Ù…ÙˆØ¯ÙŠ', 'Ø£ÙÙ‚ÙŠ'], ['Ø£ØºÙ„Ø¨ÙŠØ©', 'Ø£Ù‚Ù„ÙŠØ©'], ['Ø²ÙŠØ§Ø¯Ø©', 'Ù†Ù‚ØµØ§Ù†'],
                ['Ù…Ø£Ù„ÙˆÙ', 'ØºØ±ÙŠØ¨'], ['ÙˆØ§Ø«Ù‚', 'Ù…ØªØ±Ø¯Ø¯'], ['ØªØ´Ø¬ÙŠØ¹', 'Ø¥Ø­Ø¨Ø§Ø·'],
                ['Ù…Ø¯Ø®Ù„', 'Ù…Ø®Ø±Ø¬'], ['Ø£ØµÙ„ÙŠ', 'Ù…Ù‚Ù„Ø¯'], ['Ù…Ù†Ø·Ù‚ÙŠ', 'ØºÙŠØ± Ù…Ù†Ø·Ù‚ÙŠ'],
            ]
        };
        
        // Get opposites based on current language
        function getOpposites() {
            const lang = typeof I18n !== 'undefined' ? I18n.currentLang : 'en';
            return lang === 'ar' ? oppositesAr : oppositesEn;
        }
        
        let score = 0;
        let level = 1;
        let lives = 3;
        let streak = 0;
        
        let bestStreak = 0;
        let currentPair = null;
        let usedPairs = [];
        let canAnswer = true;
        
        let highScore = GameUtils.getHighScore(GAME_KEY);
        let playerName = GameUtils.getPlayerName();
        let gradeLevel = GameUtils.getGradeLevel();
        let shuffledPairs = []; // Pre-shuffled pairs for the game
        let pairIndex = 0;
        
        const wordPrompt = document.getElementById('wordPrompt');
        const answerGrid = document.getElementById('answerGrid');
        const streakBonus = document.getElementById('streakBonus');
        
        function getDifficulty() {
            if (gradeLevel === 'kg') return 'easy';
            if (gradeLevel === 'g1-3') return level <= 3 ? 'easy' : 'medium';
            return level <= 2 ? 'easy' : level <= 5 ? 'medium' : 'hard';
        }
        
        // Fisher-Yates shuffle
        function shuffleArray(arr) {
            const shuffled = [...arr];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }
        
        // Initialize shuffled pairs at game start
        function initShuffledPairs() {
            const opposites = getOpposites();
            // Combine all difficulties and shuffle
            let allPairs = [];
            
            // Add pairs based on grade level
            if (gradeLevel === 'kg') {
                allPairs = [...opposites.easy];
            } else if (gradeLevel === 'g1-3') {
                allPairs = [...opposites.easy, ...opposites.medium];
            } else {
                allPairs = [...opposites.easy, ...opposites.medium, ...opposites.hard];
            }
            
            // Shuffle thoroughly
            shuffledPairs = shuffleArray(allPairs);
            pairIndex = 0;
        }
        
        function getNextPair() {
            // If we've used all pairs, reshuffle
            if (pairIndex >= shuffledPairs.length) {
                shuffledPairs = shuffleArray(shuffledPairs);
                pairIndex = 0;
            }
            return shuffledPairs[pairIndex++];
        }
        
        function generateQuestion() {
            canAnswer = true;
            
            currentPair = getNextPair();
            usedPairs.push(currentPair);
            
            // Randomly choose which word to show
            const showFirst = Math.random() < 0.5;
            const promptWord = showFirst ? currentPair[0] : currentPair[1];
            const correctAnswer = showFirst ? currentPair[1] : currentPair[0];
            
            // For English, show uppercase; for Arabic, keep as is
            const lang = typeof I18n !== 'undefined' ? I18n.currentLang : 'en';
            wordPrompt.textContent = lang === 'ar' ? promptWord : promptWord.toUpperCase();
            
            // Generate wrong answers from ALL pairs (more variety)
            const opposites = getOpposites();
            const allWords = [...opposites.easy, ...opposites.medium, ...opposites.hard].flat();
            const wrongAnswers = [];
            
            while (wrongAnswers.length < 3) {
                const randomWord = allWords[Math.floor(Math.random() * allWords.length)];
                if (randomWord !== correctAnswer && 
                    randomWord !== promptWord && 
                    !wrongAnswers.includes(randomWord)) {
                    wrongAnswers.push(randomWord);
                }
            }
            
            // Combine and shuffle
            const options = [correctAnswer, ...wrongAnswers].sort(() => Math.random() - 0.5);
            
            // Create buttons
            answerGrid.innerHTML = '';
            options.forEach(option => {
                const btn = document.createElement('button');
                btn.className = 'answer-btn';
                btn.textContent = option;
                btn.onclick = () => checkAnswer(btn, option, correctAnswer);
                answerGrid.appendChild(btn);
            });
        }
        
        function checkAnswer(btn, selected, correct) {
            if (!canAnswer) return;
            canAnswer = false;
            
            const buttons = answerGrid.querySelectorAll('.answer-btn');
            buttons.forEach(b => b.disabled = true);
            
            if (selected === correct) {
                btn.classList.add('correct');
                streak++;
                
                // Streak bonus scoring
                const streakMultiplier = Math.min(streak, 5);
                const points = 10 * level * streakMultiplier;
                score += points;
                
                if (streak >= 3) {
                    streakBonus.classList.add('hot');
                }
                const streakLabel = typeof I18n !== 'undefined' ? I18n.t('game.streak') : 'Streak';
                streakBonus.textContent = `ğŸ”¥ ${streakLabel}: ${streak}`;
                
                if (streak > bestStreak) bestStreak = streak;
                
                GameUtils.playSound('correct');
                
                // Level up every 5 correct
                if (usedPairs.length % 5 === 0) {
                    level++;
                    document.getElementById('level').textContent = level;
                    GameUtils.playSound('levelUp');
                }
                
                document.getElementById('score').textContent = score;
            } else {
                btn.classList.add('wrong');
                // Show correct
                buttons.forEach(b => {
                    if (b.textContent === correct) b.classList.add('correct');
                });
                
                streak = 0;
                streakBonus.classList.remove('hot');
                const streakLabel = typeof I18n !== 'undefined' ? I18n.t('game.streak') : 'Streak';
                streakBonus.textContent = `ğŸ”¥ ${streakLabel}: 0`;
                
                lives--;
                document.getElementById('lives').textContent = lives;
                GameUtils.playSound('wrong');
                
                if (lives <= 0) {
                    setTimeout(endGame, 1000);
                    return;
                }
            }
            
            setTimeout(generateQuestion, 1200);
        }
        
        function startGame() {
            score = 0;
            level = 1;
            streak = 0;
            
            playerName = GameUtils.getPlayerName();
            gradeLevel = GameUtils.getGradeLevel();
            lives = GameUtils.getMaxLives({kg: 10, 'g1-3': 6, default: 3});
            bestStreak = 0;
            usedPairs = [];
            
            highScore = GameUtils.getHighScore(GAME_KEY);
            
            // Shuffle all pairs at game start for better randomization
            initShuffledPairs();
            
            document.getElementById('score').textContent = score;
            document.getElementById('level').textContent = level;
            document.getElementById('lives').textContent = lives;
            const streakLabelInit = typeof I18n !== 'undefined' ? I18n.t('game.streak') : 'Streak';
            streakBonus.textContent = `ğŸ”¥ ${streakLabelInit}: 0`;
            streakBonus.classList.remove('hot');
            document.getElementById('gameOver').style.display = 'none';
            
            generateQuestion();
        }
        
        function endGame() {
            const isNewHigh = GameUtils.saveHighScore(GAME_KEY, score, playerName);
            if (isNewHigh) highScore = score;
            
            const bestScore = Math.max(score, highScore);
            const bestPlayer = GameUtils.getHighScorePlayerName(GAME_KEY);
            
            document.getElementById('finalScore').textContent = score;
            document.getElementById('highScore').textContent = `${bestScore} by ${bestPlayer}`;
            document.getElementById('bestStreak').textContent = bestStreak;
            document.getElementById('playerDisplay').textContent = playerName + "'s Game";
            document.getElementById('gameOver').style.display = 'block';
        }
        
        // Initialize
        GameUtils.initSoundToggle();
        
        // Auto-start game after DOM and i18n are ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => setTimeout(() => startGame(), 100));
        } else {
            setTimeout(() => startGame(), 100);
        }
    </script>
    <script>
        // Add language toggle button
        if (typeof I18n !== 'undefined') {
            const langBtn = I18n.createLanguageToggle();
            document.body.appendChild(langBtn);
        }
    </script>
</body>
</html>
