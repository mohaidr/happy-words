<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Google Analytics -->
    <script src="../js/analytics.js"></script>
    <script src="../js/i18n.js"></script>
    <title>Opposite Match â†”ï¸</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Baloo+Bhaijaan+2:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/games.css">
    <style>
        body {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
        }
        
        .game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            max-width: 400px;
            margin: 0 auto;
            padding: 30px;
        }
        
        .word-prompt {
            background: linear-gradient(145deg, #fff, #f0f0f0);
            padding: 25px 50px;
            border-radius: 20px;
            font-size: 36px;
            font-weight: bold;
            color: #2d3436;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            min-width: 150px;
            text-align: center;
            display: inline-block;
        }
        
        .question-text {
            font-size: 20px;
            opacity: 0.9;
        }
        
        .answer-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            width: 100%;
        }
        
        .answer-btn {
            padding: 20px;
            font-size: 22px;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            border: none;
            border-radius: 18px;
            background: linear-gradient(145deg, #fff, #e0e0e0);
            color: #2d3436;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            min-height: 80px;
        }
        
        .answer-btn:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 8px 25px rgba(0,0,0,0.25);
        }
        
        .answer-btn.correct {
            background: linear-gradient(145deg, #00b894, #00cec9);
            color: white;
            animation: pulse 0.5s ease;
        }
        
        .answer-btn.wrong {
            background: linear-gradient(145deg, #d63031, #e74c3c);
            color: white;
            animation: shake 0.3s ease;
        }
        
        .streak-bonus {
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 10px;
            font-size: 16px;
        }
        
        .streak-bonus.hot {
            background: rgba(255,107,107,0.3);
            animation: glow 1s ease infinite;
        }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 10px rgba(255,107,107,0.5); }
            50% { box-shadow: 0 0 20px rgba(255,107,107,0.8); }
        }
        
        #gameOver h2 { color: #a29bfe; }
    </style>
</head>
<body>
    <div class="top-bar">
        <a href="../index.html" class="home-btn" data-i18n="game.home">â† Home</a>
        <a href="category-reading.html" class="category-btn" data-i18n="nav.reading">ğŸ“š Reading</a>
        <h1 data-i18n="oppositeMatch.title">â†”ï¸ Opposite Match</h1>
    </div>
    
    <div class="stats">
        <div><span data-i18n="game.score">Score</span>: <span id="score">0</span></div>
        <div><span data-i18n="game.level">Level</span>: <span id="level">1</span></div>
        <div>â¤ï¸ <span id="lives">3</span></div>
    </div>
    
    <div class="game-area">
        <div class="streak-bonus" id="streakBonus">ğŸ”¥ Streak: 0</div>
        
        <p class="question-text" data-i18n="oppositeMatch.instruction">What is the OPPOSITE of...</p>
        
        <div class="word-prompt" id="wordPrompt">HOT</div>
        
        <div class="answer-grid" id="answerGrid"></div>
    </div>
    
    <div id="gameOver">
        <h2 data-i18n="oppositeMatch.result">ğŸ‰ Great Job!</h2>
        <p id="playerDisplay"></p>
        <p><span data-i18n="game.finalScoreLabel">Final Score</span>: <span id="finalScore">0</span></p>
        <p>ğŸ† <span data-i18n="game.highScore">High Score</span>: <span id="highScore">0</span></p>
        <p><span data-i18n="game.bestStreak">Best Streak</span>: <span id="bestStreak">0</span></p>
        <button class="btn" onclick="startGame()" data-i18n="game.playAgain">Play Again</button>
        <a href="../index.html" class="home-link">â† Back to Home</a>
    </div>
    
    <p class="info" data-i18n="oppositeMatch.hint">Find the word that means the opposite!</p>

    <script src="../js/game-utils.js"></script>
    <script>
        const GAME_KEY = 'oppositeMatch';
        
        // English opposite pairs by difficulty
        const oppositesEn = {
            easy: [
                ['hot', 'cold'], ['big', 'small'], ['up', 'down'],
                ['happy', 'sad'], ['fast', 'slow'], ['day', 'night'],
                ['old', 'young'], ['open', 'close'], ['in', 'out'],
                ['yes', 'no'], ['stop', 'go'], ['boy', 'girl'],
                ['tall', 'short'], ['wet', 'dry'], ['full', 'empty'],
                ['light', 'dark'], ['soft', 'hard'], ['clean', 'dirty'],
                ['loud', 'quiet'], ['push', 'pull'], ['top', 'bottom'],
                ['new', 'old'], ['good', 'bad'], ['left', 'right'],
                ['high', 'low'], ['here', 'there'], ['come', 'go'],
                ['sit', 'stand'], ['run', 'walk'], ['sleep', 'wake'],
                ['front', 'back'], ['near', 'far'], ['first', 'last'],
                ['on', 'off'], ['black', 'white'], ['sun', 'moon'],
                ['add', 'subtract'], ['over', 'under'], ['inside', 'outside'],
                ['before', 'after'], ['above', 'below'], ['buy', 'sell'],
                ['ask', 'answer'], ['many', 'few'], ['more', 'less'],
                ['same', 'different'], ['early', 'late'], ['start', 'finish'],
                ['lost', 'found'], ['hide', 'seek'], ['nice', 'mean'],
                ['sink', 'float'], ['thin', 'fat'], ['warm', 'cool'],
            ],
            medium: [
                ['brave', 'scared'], ['kind', 'mean'], ['strong', 'weak'],
                ['sweet', 'sour'], ['rich', 'poor'], ['thick', 'thin'],
                ['heavy', 'light'], ['rough', 'smooth'], ['sharp', 'dull'],
                ['deep', 'shallow'], ['wide', 'narrow'], ['loose', 'tight'],
                ['wild', 'tame'], ['asleep', 'awake'], ['begin', 'end'],
                ['love', 'hate'], ['laugh', 'cry'], ['win', 'lose'],
                ['remember', 'forget'], ['true', 'false'], ['give', 'take'],
                ['friend', 'enemy'], ['peace', 'war'], ['safe', 'dangerous'],
                ['quiet', 'noisy'], ['bright', 'dim'], ['wise', 'foolish'],
                ['clever', 'dumb'], ['honest', 'dishonest'], ['calm', 'angry'],
                ['tidy', 'messy'], ['lazy', 'busy'], ['proud', 'ashamed'],
                ['fancy', 'plain'], ['fresh', 'stale'], ['ripe', 'unripe'],
                ['whole', 'broken'], ['real', 'fake'], ['common', 'rare'],
                ['cheap', 'expensive'], ['easy', 'hard'], ['simple', 'complex'],
                ['boring', 'fun'], ['gentle', 'rough'], ['major', 'minor'],
                ['public', 'private'], ['normal', 'weird'], ['silent', 'loud'],
                ['polite', 'rude'], ['lucky', 'unlucky'], ['careful', 'careless'],
                ['useful', 'useless'], ['helpful', 'harmful'], ['possible', 'impossible'],
                ['visible', 'invisible'], ['legal', 'illegal'], ['active', 'inactive'],
            ],
            hard: [
                ['ancient', 'modern'], ['arrive', 'depart'], ['attack', 'defend'],
                ['boring', 'exciting'], ['capture', 'release'], ['certain', 'doubtful'],
                ['combine', 'separate'], ['create', 'destroy'], ['expand', 'shrink'],
                ['generous', 'selfish'], ['innocent', 'guilty'], ['maximum', 'minimum'],
                ['permanent', 'temporary'], ['positive', 'negative'], ['polite', 'rude'],
                ['success', 'failure'], ['accept', 'reject'], ['include', 'exclude'],
                ['artificial', 'natural'], ['amateur', 'professional'], ['abstract', 'concrete'],
                ['voluntary', 'mandatory'], ['frequent', 'rare'], ['gradual', 'sudden'],
                ['humble', 'arrogant'], ['abundant', 'scarce'], ['flexible', 'rigid'],
                ['transparent', 'opaque'], ['superior', 'inferior'], ['external', 'internal'],
                ['vertical', 'horizontal'], ['majority', 'minority'], ['offensive', 'defensive'],
                ['optimistic', 'pessimistic'], ['domestic', 'foreign'], ['urban', 'rural'],
                ['courage', 'cowardice'], ['victory', 'defeat'], ['increase', 'decrease'],
                ['complex', 'simple'], ['familiar', 'strange'], ['freedom', 'captivity'],
                ['harmony', 'conflict'], ['ignorance', 'knowledge'], ['celebrate', 'mourn'],
                ['confident', 'insecure'], ['advance', 'retreat'], ['approve', 'disapprove'],
                ['benefit', 'harm'], ['construct', 'demolish'], ['encourage', 'discourage'],
                ['entrance', 'exit'], ['genuine', 'counterfeit'], ['logical', 'illogical'],
                ['precious', 'worthless'], ['reward', 'punish'], ['voluntary', 'compulsory'],
            ]
        };
        
        // Arabic opposite pairs (Ø§Ù„Ø£Ø¶Ø¯Ø§Ø¯)
        const oppositesAr = {
            easy: [
                ['Ø­Ø§Ø±', 'Ø¨Ø§Ø±Ø¯'], ['ÙƒØ¨ÙŠØ±', 'ØµØºÙŠØ±'], ['ÙÙˆÙ‚', 'ØªØ­Øª'],
                ['Ø³Ø¹ÙŠØ¯', 'Ø­Ø²ÙŠÙ†'], ['Ø³Ø±ÙŠØ¹', 'Ø¨Ø·ÙŠØ¡'], ['Ù†Ù‡Ø§Ø±', 'Ù„ÙŠÙ„'],
                ['Ù‚Ø¯ÙŠÙ…', 'Ø¬Ø¯ÙŠØ¯'], ['Ù…ÙØªÙˆØ­', 'Ù…ØºÙ„Ù‚'], ['Ø¯Ø§Ø®Ù„', 'Ø®Ø§Ø±Ø¬'],
                ['Ù†Ø¹Ù…', 'Ù„Ø§'], ['Ù‚Ù', 'Ø§Ù…Ø´Ù'], ['ÙˆÙ„Ø¯', 'Ø¨Ù†Øª'],
                ['Ø·ÙˆÙŠÙ„', 'Ù‚ØµÙŠØ±'], ['Ù…Ø¨Ù„Ù„', 'Ø¬Ø§Ù'], ['Ù…Ù…ØªÙ„Ø¦', 'ÙØ§Ø±Øº'],
                ['ÙØ§ØªØ­', 'ØºØ§Ù…Ù‚'], ['Ù†Ø§Ø¹Ù…', 'Ø®Ø´Ù†'], ['Ù†Ø¸ÙŠÙ', 'ÙˆØ³Ø®'],
                ['Ø¹Ø§Ù„ÙŠ', 'Ù…Ù†Ø®ÙØ¶'], ['Ø¯ÙØ¹', 'Ø³Ø­Ø¨'], ['Ø£Ø¹Ù„Ù‰', 'Ø£Ø³ÙÙ„'],
                ['Ø£Ø¨ÙŠØ¶', 'Ø£Ø³ÙˆØ¯'], ['Ø¬ÙŠØ¯', 'Ø³ÙŠØ¡'], ['ÙŠÙ…ÙŠÙ†', 'ÙŠØ³Ø§Ø±'],
                ['Ù‡Ù†Ø§', 'Ù‡Ù†Ø§Ùƒ'], ['ØªØ¹Ø§Ù„', 'Ø§Ø°Ù‡Ø¨'], ['Ø§Ø¬Ù„Ø³', 'Ù‚Ù'],
                ['Ù†Ø§Ù…', 'Ø§Ø³ØªÙŠÙ‚Ø¸'], ['Ø£Ù…Ø§Ù…', 'Ø®Ù„Ù'], ['Ù‚Ø±ÙŠØ¨', 'Ø¨Ø¹ÙŠØ¯'],
                ['Ø£ÙˆÙ„', 'Ø¢Ø®Ø±'], ['Ø´Ù…Ø³', 'Ù‚Ù…Ø±'], ['ØµÙŠÙ', 'Ø´ØªØ§Ø¡'],
                ['Ø¨Ø¯Ø§ÙŠØ©', 'Ù†Ù‡Ø§ÙŠØ©'], ['ÙƒØ«ÙŠØ±', 'Ù‚Ù„ÙŠÙ„'], ['Ø£ÙƒØ«Ø±', 'Ø£Ù‚Ù„'],
                ['Ù…Ø¨ÙƒØ±', 'Ù…ØªØ£Ø®Ø±'], ['Ø¶Ø§Ø¦Ø¹', 'Ù…ÙˆØ¬ÙˆØ¯'], ['Ø±ÙÙŠØ¹', 'Ø³Ù…ÙŠÙ†'],
            ],
            medium: [
                ['Ø´Ø¬Ø§Ø¹', 'Ø®Ø§Ø¦Ù'], ['Ù„Ø·ÙŠÙ', 'Ù‚Ø§Ø³ÙŠ'], ['Ù‚ÙˆÙŠ', 'Ø¶Ø¹ÙŠÙ'],
                ['Ø­Ù„Ùˆ', 'Ø­Ø§Ù…Ø¶'], ['ØºÙ†ÙŠ', 'ÙÙ‚ÙŠØ±'], ['Ø³Ù…ÙŠÙƒ', 'Ø±ÙÙŠØ¹'],
                ['Ø«Ù‚ÙŠÙ„', 'Ø®ÙÙŠÙ'], ['Ø®Ø´Ù†', 'Ù†Ø§Ø¹Ù…'], ['Ø­Ø§Ø¯', 'Ø¨Ø§Ù‡Øª'],
                ['Ø¹Ù…ÙŠÙ‚', 'Ø¶Ø­Ù„'], ['ÙˆØ§Ø³Ø¹', 'Ø¶ÙŠÙ‚'], ['ÙØ¶ÙØ§Ø¶', 'Ø¶ÙŠÙ‚'],
                ['Ø¨Ø±ÙŠ', 'Ø£Ù„ÙŠÙ'], ['Ù†Ø§Ø¦Ù…', 'Ù…Ø³ØªÙŠÙ‚Ø¸'], ['ÙŠØ¨Ø¯Ø£', 'ÙŠÙ†ØªÙ‡ÙŠ'],
                ['Ø­Ø¨', 'ÙƒØ±Ù‡'], ['Ø¶Ø­Ùƒ', 'Ø¨ÙƒØ§Ø¡'], ['ÙÙˆØ²', 'Ø®Ø³Ø§Ø±Ø©'],
                ['ØªØ°ÙƒØ±', 'Ù†Ø³ÙŠ'], ['ØµØ­ÙŠØ­', 'Ø®Ø·Ø£'], ['Ø£Ø¹Ø·Ù‰', 'Ø£Ø®Ø°'],
                ['ØµØ¯ÙŠÙ‚', 'Ø¹Ø¯Ùˆ'], ['Ø³Ù„Ø§Ù…', 'Ø­Ø±Ø¨'], ['Ø¢Ù…Ù†', 'Ø®Ø·ÙŠØ±'],
                ['Ù‡Ø§Ø¯Ø¦', 'ØµØ§Ø®Ø¨'], ['Ø³Ø§Ø·Ø¹', 'Ø®Ø§ÙØª'], ['Ø­ÙƒÙŠÙ…', 'Ø£Ø­Ù…Ù‚'],
                ['ØµØ§Ø¯Ù‚', 'ÙƒØ§Ø°Ø¨'], ['Ù‡Ø§Ø¯Ø¦', 'ØºØ§Ø¶Ø¨'], ['Ù…Ø±ØªØ¨', 'ÙÙˆØ¶ÙˆÙŠ'],
                ['ÙƒØ³ÙˆÙ„', 'Ù†Ø´ÙŠØ·'], ['ÙØ®ÙˆØ±', 'Ø®Ø¬ÙˆÙ„'], ['Ø·Ø§Ø²Ø¬', 'ÙØ§Ø³Ø¯'],
                ['ÙƒØ§Ù…Ù„', 'Ù…ÙƒØ³ÙˆØ±'], ['Ø­Ù‚ÙŠÙ‚ÙŠ', 'Ù…Ø²ÙŠÙ'], ['Ø±Ø®ÙŠØµ', 'ØºØ§Ù„ÙŠ'],
                ['Ø³Ù‡Ù„', 'ØµØ¹Ø¨'], ['Ø¨Ø³ÙŠØ·', 'Ù…Ø¹Ù‚Ø¯'], ['Ù…Ù…Ù„', 'Ù…Ù…ØªØ¹'],
                ['Ù…Ø¤Ø¯Ø¨', 'ÙˆÙ‚Ø­'], ['Ù…Ø­Ø¸ÙˆØ¸', 'Ø³ÙŠØ¡ Ø§Ù„Ø­Ø¸'], ['Ø­Ø°Ø±', 'Ù…ØªÙ‡ÙˆØ±'],
            ],
            hard: [
                ['Ù‚Ø¯ÙŠÙ…', 'Ø­Ø¯ÙŠØ«'], ['ÙˆØµÙ„', 'ØºØ§Ø¯Ø±'], ['Ù‡Ø¬ÙˆÙ…', 'Ø¯ÙØ§Ø¹'],
                ['Ù…Ù…Ù„', 'Ù…Ø«ÙŠØ±'], ['Ø£Ø³Ø±', 'Ø£Ø·Ù„Ù‚'], ['Ù…ØªØ£ÙƒØ¯', 'Ø´Ø§Ùƒ'],
                ['Ø¯Ù…Ø¬', 'ÙØµÙ„'], ['Ø®Ù„Ù‚', 'Ø¯Ù…Ø±'], ['ØªÙˆØ³Ø¹', 'ØªÙ‚Ù„Øµ'],
                ['ÙƒØ±ÙŠÙ…', 'Ø£Ù†Ø§Ù†ÙŠ'], ['Ø¨Ø±ÙŠØ¡', 'Ù…Ø°Ù†Ø¨'], ['Ø£Ù‚ØµÙ‰', 'Ø£Ø¯Ù†Ù‰'],
                ['Ø¯Ø§Ø¦Ù…', 'Ù…Ø¤Ù‚Øª'], ['Ø¥ÙŠØ¬Ø§Ø¨ÙŠ', 'Ø³Ù„Ø¨ÙŠ'], ['Ù†Ø¬Ø§Ø­', 'ÙØ´Ù„'],
                ['Ù‚Ø¨ÙˆÙ„', 'Ø±ÙØ¶'], ['ØªØ¶Ù…ÙŠÙ†', 'Ø§Ø³ØªØ¨Ø¹Ø§Ø¯'], ['ØµÙ†Ø§Ø¹ÙŠ', 'Ø·Ø¨ÙŠØ¹ÙŠ'],
                ['Ù‡Ø§ÙˆÙŠ', 'Ù…Ø­ØªØ±Ù'], ['Ù…ØªÙƒØ±Ø±', 'Ù†Ø§Ø¯Ø±'], ['ØªØ¯Ø±ÙŠØ¬ÙŠ', 'Ù…ÙØ§Ø¬Ø¦'],
                ['Ù…ØªÙˆØ§Ø¶Ø¹', 'Ù…ØªÙƒØ¨Ø±'], ['ÙˆÙÙŠØ±', 'Ø´Ø­ÙŠØ­'], ['Ù…Ø±Ù†', 'ØµÙ„Ø¨'],
                ['Ø´ÙØ§Ù', 'Ù…Ø¹ØªÙ…'], ['Ø£Ø¹Ù„Ù‰', 'Ø£Ø¯Ù†Ù‰'], ['Ø®Ø§Ø±Ø¬ÙŠ', 'Ø¯Ø§Ø®Ù„ÙŠ'],
                ['Ø¹Ù…ÙˆØ¯ÙŠ', 'Ø£ÙÙ‚ÙŠ'], ['Ø£ØºÙ„Ø¨ÙŠØ©', 'Ø£Ù‚Ù„ÙŠØ©'], ['ØªÙØ§Ø¤Ù„', 'ØªØ´Ø§Ø¤Ù…'],
                ['Ù…Ø­Ù„ÙŠ', 'Ø£Ø¬Ù†Ø¨ÙŠ'], ['Ø­Ø¶Ø±ÙŠ', 'Ø±ÙŠÙÙŠ'], ['Ø´Ø¬Ø§Ø¹Ø©', 'Ø¬Ø¨Ù†'],
                ['Ø§Ù†ØªØµØ§Ø±', 'Ù‡Ø²ÙŠÙ…Ø©'], ['Ø²ÙŠØ§Ø¯Ø©', 'Ù†Ù‚ØµØ§Ù†'], ['Ù…Ø¹Ù‚Ø¯', 'Ø¨Ø³ÙŠØ·'],
                ['Ù…Ø£Ù„ÙˆÙ', 'ØºØ±ÙŠØ¨'], ['Ø­Ø±ÙŠØ©', 'Ø£Ø³Ø±'], ['ØªØ´Ø¬ÙŠØ¹', 'Ø¥Ø­Ø¨Ø§Ø·'],
            ]
        };
        
        // Get opposites based on current language
        function getOpposites() {
            const lang = typeof I18n !== 'undefined' ? I18n.currentLang : 'en';
            return lang === 'ar' ? oppositesAr : oppositesEn;
        }
        
        let score = 0;
        let level = 1;
        let lives = 3;
        let streak = 0;
        
        let bestStreak = 0;
        let currentPair = null;
        let usedPairs = [];
        let canAnswer = true;
        
        let highScore = GameUtils.getHighScore(GAME_KEY);
        let playerName = GameUtils.getPlayerName();
        let gradeLevel = GameUtils.getGradeLevel();
        
        const wordPrompt = document.getElementById('wordPrompt');
        const answerGrid = document.getElementById('answerGrid');
        const streakBonus = document.getElementById('streakBonus');
        
        function getDifficulty() {
            if (gradeLevel === 'kg') return 'easy';
            if (gradeLevel === 'g1-3') return level <= 3 ? 'easy' : 'medium';
            return level <= 2 ? 'easy' : level <= 5 ? 'medium' : 'hard';
        }
        
        function getUnusedPair() {
            const difficulty = getDifficulty();
            const opposites = getOpposites();
            const pool = opposites[difficulty].filter(p => 
                !usedPairs.some(u => u[0] === p[0])
            );
            
            if (pool.length === 0) {
                usedPairs = [];
                return opposites[difficulty][Math.floor(Math.random() * opposites[difficulty].length)];
            }
            
            return pool[Math.floor(Math.random() * pool.length)];
        }
        
        function generateQuestion() {
            canAnswer = true;
            
            currentPair = getUnusedPair();
            usedPairs.push(currentPair);
            
            // Randomly choose which word to show
            const showFirst = Math.random() < 0.5;
            const promptWord = showFirst ? currentPair[0] : currentPair[1];
            const correctAnswer = showFirst ? currentPair[1] : currentPair[0];
            
            // For English, show uppercase; for Arabic, keep as is
            const lang = typeof I18n !== 'undefined' ? I18n.currentLang : 'en';
            wordPrompt.textContent = lang === 'ar' ? promptWord : promptWord.toUpperCase();
            
            // Generate wrong answers from other pairs
            const difficulty = getDifficulty();
            const opposites = getOpposites();
            const wrongAnswers = [];
            const allWords = opposites[difficulty].flat();
            
            while (wrongAnswers.length < 3) {
                const randomWord = allWords[Math.floor(Math.random() * allWords.length)];
                if (randomWord !== correctAnswer && 
                    randomWord !== promptWord && 
                    !wrongAnswers.includes(randomWord)) {
                    wrongAnswers.push(randomWord);
                }
            }
            
            // Combine and shuffle
            const options = [correctAnswer, ...wrongAnswers].sort(() => Math.random() - 0.5);
            
            // Create buttons
            answerGrid.innerHTML = '';
            options.forEach(option => {
                const btn = document.createElement('button');
                btn.className = 'answer-btn';
                btn.textContent = option;
                btn.onclick = () => checkAnswer(btn, option, correctAnswer);
                answerGrid.appendChild(btn);
            });
        }
        
        function checkAnswer(btn, selected, correct) {
            if (!canAnswer) return;
            canAnswer = false;
            
            const buttons = answerGrid.querySelectorAll('.answer-btn');
            buttons.forEach(b => b.disabled = true);
            
            if (selected === correct) {
                btn.classList.add('correct');
                streak++;
                
                // Streak bonus scoring
                const streakMultiplier = Math.min(streak, 5);
                const points = 10 * level * streakMultiplier;
                score += points;
                
                if (streak >= 3) {
                    streakBonus.classList.add('hot');
                }
                const streakLabel = typeof I18n !== 'undefined' ? I18n.t('game.streak') : 'Streak';
                streakBonus.textContent = `ğŸ”¥ ${streakLabel}: ${streak}`;
                
                if (streak > bestStreak) bestStreak = streak;
                
                GameUtils.playSound('correct');
                
                // Level up every 5 correct
                if (usedPairs.length % 5 === 0) {
                    level++;
                    document.getElementById('level').textContent = level;
                    GameUtils.playSound('levelUp');
                }
                
                document.getElementById('score').textContent = score;
            } else {
                btn.classList.add('wrong');
                // Show correct
                buttons.forEach(b => {
                    if (b.textContent === correct) b.classList.add('correct');
                });
                
                streak = 0;
                streakBonus.classList.remove('hot');
                const streakLabel = typeof I18n !== 'undefined' ? I18n.t('game.streak') : 'Streak';
                streakBonus.textContent = `ğŸ”¥ ${streakLabel}: 0`;
                
                lives--;
                document.getElementById('lives').textContent = lives;
                GameUtils.playSound('wrong');
                
                if (lives <= 0) {
                    setTimeout(endGame, 1000);
                    return;
                }
            }
            
            setTimeout(generateQuestion, 1200);
        }
        
        function startGame() {
            score = 0;
            level = 1;
            streak = 0;
            
            playerName = GameUtils.getPlayerName();
            gradeLevel = GameUtils.getGradeLevel();
            lives = GameUtils.getMaxLives({kg: 10, 'g1-3': 6, default: 3});
            bestStreak = 0;
            usedPairs = [];
            
            playerName = GameUtils.getPlayerName();
            gradeLevel = GameUtils.getGradeLevel();
            highScore = GameUtils.getHighScore(GAME_KEY);
            
            document.getElementById('score').textContent = score;
            document.getElementById('level').textContent = level;
            document.getElementById('lives').textContent = lives;
            const streakLabelInit = typeof I18n !== 'undefined' ? I18n.t('game.streak') : 'Streak';
            streakBonus.textContent = `ğŸ”¥ ${streakLabelInit}: 0`;
            streakBonus.classList.remove('hot');
            document.getElementById('gameOver').style.display = 'none';
            
            generateQuestion();
        }
        
        function endGame() {
            const isNewHigh = GameUtils.saveHighScore(GAME_KEY, score, playerName);
            if (isNewHigh) highScore = score;
            
            const bestScore = Math.max(score, highScore);
            const bestPlayer = GameUtils.getHighScorePlayerName(GAME_KEY);
            
            document.getElementById('finalScore').textContent = score;
            document.getElementById('highScore').textContent = `${bestScore} by ${bestPlayer}`;
            document.getElementById('bestStreak').textContent = bestStreak;
            document.getElementById('playerDisplay').textContent = playerName + "'s Game";
            document.getElementById('gameOver').style.display = 'block';
        }
        
        // Initialize
        GameUtils.initSoundToggle();
        setTimeout(() => startGame(), 500);
    </script>
    <script>
        // Add language toggle button
        if (typeof I18n !== 'undefined') {
            const langBtn = I18n.createLanguageToggle();
            document.body.appendChild(langBtn);
        }
    </script>
</body>
</html>
