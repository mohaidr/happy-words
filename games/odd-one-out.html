<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Google Analytics -->
    <script src="../js/analytics.js"></script>
    <script src="../js/i18n.js"></script>
    <title>Odd One Out üîç</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Baloo+Bhaijaan+2:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/games.css">
    <style>
        body {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
        }
        
        .game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            max-width: 400px;
            margin: 0 auto;
            padding: 30px;
        }
        
        .instruction {
            background: rgba(255,255,255,0.2);
            padding: 12px 25px;
            border-radius: 15px;
            font-size: 20px;
        }
        
        .items-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            width: 100%;
        }
        
        .item-card {
            background: linear-gradient(145deg, #fff, #f5f5f5);
            border-radius: 20px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            min-height: 110px;
            border: 3px solid transparent;
        }
        
        .item-card:hover {
            transform: translateY(-4px) scale(1.03);
            box-shadow: 0 10px 30px rgba(0,0,0,0.25);
        }
        
        .item-card .emoji {
            font-size: 48px;
        }
        
        .item-card .label {
            font-size: 16px;
            font-weight: 600;
            color: #2d3436;
        }
        
        .item-card.correct {
            background: linear-gradient(145deg, #00b894, #00cec9);
            border-color: #00b894;
            animation: pulse 0.5s ease;
        }
        
        .item-card.correct .label {
            color: white;
        }
        
        .item-card.wrong {
            background: linear-gradient(145deg, #d63031, #e74c3c);
            border-color: #d63031;
            animation: shake 0.3s ease;
        }
        
        .item-card.wrong .label {
            color: white;
        }
        
        .item-card.highlight {
            border-color: #fdcb6e;
            background: linear-gradient(145deg, #ffeaa7, #fdcb6e);
        }
        
        .category-hint {
            background: rgba(0,0,0,0.2);
            padding: 10px 20px;
            border-radius: 12px;
            font-size: 16px;
            min-height: 40px;
        }
        
        #gameOver h2 { color: #a29bfe; }
    </style>
</head>
<body>
    <div class="top-bar">
        <a href="../index.html" class="home-btn" data-i18n="game.home">‚Üê Home</a>
        <a href="category-logic.html" class="category-btn" data-i18n="nav.logic">üß† Logic</a>
        <h1 data-i18n="oddOneOut.title">üîç Odd One Out</h1>
    </div>
    
    <div class="stats">
        <div><span data-i18n="game.score">Score</span>: <span id="score">0</span></div>
        <div><span data-i18n="game.level">Level</span>: <span id="level">1</span></div>
        <div>‚ù§Ô∏è <span id="lives">3</span></div>
    </div>
    
    <div class="game-area">
        <div class="instruction" data-i18n="oddOneOut.instruction">Which one doesn't belong?</div>
        
        <div class="items-grid" id="itemsGrid"></div>
        
        <div class="category-hint" id="categoryHint"></div>
    </div>
    
    <div id="gameOver">
        <h2 data-i18n="oddOneOut.result">üéâ Great Job!</h2>
        <p id="playerDisplay"></p>
        <p id="finalScoreText"></p>
        <p id="highScoreText"></p>
        <button class="btn" onclick="startGame()" data-i18n="game.playAgain">Play Again</button>
        <a href="../index.html" class="home-link" data-i18n="game.home">‚Üê Back to Home</a>
    </div>
    
    <p class="info" data-i18n="oddOneOut.info">Find the one that's different from the others!</p>
    <p class="info" id="bestScoreDisplay">üèÜ Best: --</p>

    <script src="../js/game-utils.js"></script>
    <script>
        const GAME_KEY = 'oddOneOut';
        
        // Categories with items (using i18n keys)
        const categories = {
            fruits: {
                nameKey: 'cat.fruits',
                items: [
                    { emoji: 'üçé', labelKey: 'item.apple' },
                    { emoji: 'üçå', labelKey: 'item.banana' },
                    { emoji: 'üçá', labelKey: 'item.grapes' },
                    { emoji: 'üçä', labelKey: 'item.orange' },
                    { emoji: 'üçì', labelKey: 'item.strawberry' },
                    { emoji: 'üçë', labelKey: 'item.peach' },
                ]
            },
            animals: {
                nameKey: 'cat.animals',
                items: [
                    { emoji: 'üê∂', labelKey: 'item.dog' },
                    { emoji: 'üê±', labelKey: 'item.cat' },
                    { emoji: 'üê∞', labelKey: 'item.rabbit' },
                    { emoji: 'üêª', labelKey: 'item.bear' },
                    { emoji: 'ü¶Å', labelKey: 'item.lion' },
                    { emoji: 'üêò', labelKey: 'item.elephant' },
                ]
            },
            vehicles: {
                nameKey: 'cat.vehicles',
                items: [
                    { emoji: 'üöó', labelKey: 'item.car' },
                    { emoji: 'üöå', labelKey: 'item.bus' },
                    { emoji: 'üöÅ', labelKey: 'item.helicopter' },
                    { emoji: 'üöÇ', labelKey: 'item.train' },
                    { emoji: 'üö≤', labelKey: 'item.bike' },
                    { emoji: '‚úàÔ∏è', labelKey: 'item.plane' },
                ]
            },
            food: {
                nameKey: 'cat.food',
                items: [
                    { emoji: 'üçï', labelKey: 'item.pizza' },
                    { emoji: 'üçî', labelKey: 'item.burger' },
                    { emoji: 'üå≠', labelKey: 'item.hotdog' },
                    { emoji: 'üçü', labelKey: 'item.fries' },
                    { emoji: 'üåÆ', labelKey: 'item.taco' },
                    { emoji: 'üç©', labelKey: 'item.donut' },
                ]
            },
            sports: {
                nameKey: 'cat.sports',
                items: [
                    { emoji: '‚öΩ', labelKey: 'item.soccer' },
                    { emoji: 'üèÄ', labelKey: 'item.basketball' },
                    { emoji: 'üéæ', labelKey: 'item.tennis' },
                    { emoji: '‚öæ', labelKey: 'item.baseball' },
                    { emoji: 'üèà', labelKey: 'item.football' },
                    { emoji: 'üèê', labelKey: 'item.volleyball' },
                ]
            },
            weather: {
                nameKey: 'cat.weather',
                items: [
                    { emoji: '‚òÄÔ∏è', labelKey: 'item.sunny' },
                    { emoji: 'üåßÔ∏è', labelKey: 'item.rainy' },
                    { emoji: '‚ùÑÔ∏è', labelKey: 'item.snowy' },
                    { emoji: '‚õàÔ∏è', labelKey: 'item.stormy' },
                    { emoji: 'üå§Ô∏è', labelKey: 'item.cloudy' },
                    { emoji: 'üå™Ô∏è', labelKey: 'item.windy' },
                ]
            },
            colors: {
                nameKey: 'cat.colors',
                items: [
                    { emoji: 'üî¥', labelKey: 'item.red' },
                    { emoji: 'üîµ', labelKey: 'item.blue' },
                    { emoji: 'üü¢', labelKey: 'item.green' },
                    { emoji: 'üü°', labelKey: 'item.yellow' },
                    { emoji: 'üü£', labelKey: 'item.purple' },
                    { emoji: 'üü†', labelKey: 'item.orangeColor' },
                ]
            },
            clothes: {
                nameKey: 'cat.clothes',
                items: [
                    { emoji: 'üëï', labelKey: 'item.shirt' },
                    { emoji: 'üëñ', labelKey: 'item.pants' },
                    { emoji: 'üëó', labelKey: 'item.dress' },
                    { emoji: 'üß•', labelKey: 'item.coat' },
                    { emoji: 'üëü', labelKey: 'item.shoes' },
                    { emoji: 'üß¢', labelKey: 'item.hat' },
                ]
            },
            shapes: {
                nameKey: 'cat.shapes',
                items: [
                    { emoji: '‚¨õ', labelKey: 'item.square' },
                    { emoji: '‚ö´', labelKey: 'item.circle' },
                    { emoji: 'üî∫', labelKey: 'item.triangle' },
                    { emoji: 'üí†', labelKey: 'item.diamond' },
                    { emoji: '‚≠ê', labelKey: 'item.star' },
                    { emoji: '‚ù§Ô∏è', labelKey: 'item.heart' },
                ]
            },
            tools: {
                nameKey: 'cat.tools',
                items: [
                    { emoji: 'üî®', labelKey: 'item.hammer' },
                    { emoji: 'üîß', labelKey: 'item.wrench' },
                    { emoji: 'ü™õ', labelKey: 'item.screwdriver' },
                    { emoji: '‚úÇÔ∏è', labelKey: 'item.scissors' },
                    { emoji: 'üìè', labelKey: 'item.ruler' },
                    { emoji: 'üî©', labelKey: 'item.bolt' },
                ]
            }
        };
        
        // Helper function to get translated text
        function t(key, params) {
            return typeof I18n !== 'undefined' ? I18n.t(key, params) : key;
        }
        
        function getItemLabel(item) {
            return t(item.labelKey);
        }
        
        function getCategoryName(catKey) {
            return t(categories[catKey].nameKey);
        }
        
        let score = 0;
        let level = 1;
        let lives = 3;
        let oddItem = null;
        
        let mainCategoryKey = '';
        let questionsAnswered = 0;
        let canAnswer = true;
        
        let highScore = GameUtils.getHighScore(GAME_KEY);
        let playerName = GameUtils.getPlayerName();
        let gradeLevel = GameUtils.getGradeLevel();
        
        const itemsGrid = document.getElementById('itemsGrid');
        const categoryHint = document.getElementById('categoryHint');
        
        function getItemCount() {
            if (gradeLevel === 'kg') return 4;
            if (gradeLevel === 'g1-3') return 4 + Math.floor(level / 3);
            return 4 + Math.floor(level / 2);
        }
        
        function generateQuestion() {
            canAnswer = true;
            categoryHint.textContent = '';
            
            const catKeys = Object.keys(categories);
            const mainCatKey = catKeys[Math.floor(Math.random() * catKeys.length)];
            let oddCatKey;
            do {
                oddCatKey = catKeys[Math.floor(Math.random() * catKeys.length)];
            } while (oddCatKey === mainCatKey);
            
            mainCategoryKey = mainCatKey;
            const mainItems = [...categories[mainCatKey].items];
            const oddItems = [...categories[oddCatKey].items];
            
            // Shuffle and pick items
            mainItems.sort(() => Math.random() - 0.5);
            oddItems.sort(() => Math.random() - 0.5);
            
            const count = Math.min(getItemCount(), 6);
            const selectedMain = mainItems.slice(0, count - 1);
            oddItem = oddItems[0];
            
            // Combine and shuffle
            const allItems = [...selectedMain, oddItem].sort(() => Math.random() - 0.5);
            
            // Create cards
            itemsGrid.innerHTML = '';
            allItems.forEach(item => {
                const card = document.createElement('div');
                card.className = 'item-card';
                card.innerHTML = `
                    <span class="emoji">${item.emoji}</span>
                    <span class="label">${getItemLabel(item)}</span>
                `;
                card.onclick = () => checkAnswer(card, item);
                itemsGrid.appendChild(card);
            });
        }
        
        function checkAnswer(card, item) {
            if (!canAnswer) return;
            canAnswer = false;
            
            const cards = itemsGrid.querySelectorAll('.item-card');
            cards.forEach(c => c.style.pointerEvents = 'none');
            
            const itemLabel = getItemLabel(item);
            const categoryName = getCategoryName(mainCategoryKey);
            
            if (item === oddItem) {
                card.classList.add('correct');
                categoryHint.textContent = t('oddOneOut.correct', { item: itemLabel, category: categoryName });
                score += 10 * level;
                questionsAnswered++;
                GameUtils.playSound('correct');
                
                if (questionsAnswered % 5 === 0) {
                    level++;
                    document.getElementById('level').textContent = level;
                    GameUtils.playSound('levelUp');
                }
                
                document.getElementById('score').textContent = score;
            } else {
                card.classList.add('wrong');
                // Show correct answer
                cards.forEach(c => {
                    const emoji = c.querySelector('.emoji').textContent;
                    if (emoji === oddItem.emoji) {
                        c.classList.add('highlight');
                    }
                });
                
                const oddItemLabel = getItemLabel(oddItem);
                categoryHint.textContent = t('oddOneOut.wrong', { category: categoryName, item: oddItemLabel });
                lives--;
                document.getElementById('lives').textContent = lives;
                GameUtils.playSound('wrong');
                
                if (lives <= 0) {
                    setTimeout(endGame, 1500);
                    return;
                }
            }
            
            setTimeout(generateQuestion, 1500);
        }
        
        function startGame() {
            score = 0;
            level = 1;
            questionsAnswered = 0;
            
            playerName = GameUtils.getPlayerName();
            gradeLevel = GameUtils.getGradeLevel();
            lives = GameUtils.getMaxLives({kg: 8, 'g1-3': 5, default: 3});
            gradeLevel = GameUtils.getGradeLevel();
            highScore = GameUtils.getHighScore(GAME_KEY);
            
            document.getElementById('score').textContent = score;
            document.getElementById('level').textContent = level;
            document.getElementById('lives').textContent = lives;
            document.getElementById('gameOver').style.display = 'none';
            
            generateQuestion();
        }
        
        function loadHighScore() {
            const saved = GameUtils.getHighScore(GAME_KEY);
            if (saved > 0) {
                const bestPlayer = GameUtils.getHighScorePlayerName(GAME_KEY);
                const highScoreText = typeof I18n !== 'undefined' 
                    ? I18n.t('game.highScorePoints', { score: saved, player: bestPlayer })
                    : `üèÜ Best: ${saved} points by ${bestPlayer}`;
                document.getElementById('bestScoreDisplay').innerHTML = highScoreText;
            } else {
                const defaultText = typeof I18n !== 'undefined' 
                    ? I18n.t('game.defaultHighScore')
                    : 'Best: -- points';
                document.getElementById('bestScoreDisplay').innerHTML = defaultText;
            }
        }
        
        function endGame() {
            const isNewHigh = GameUtils.saveHighScore(GAME_KEY, score, playerName);
            if (isNewHigh) highScore = score;
            
            const bestScore = Math.max(score, highScore);
            const bestPlayer = GameUtils.getHighScorePlayerName(GAME_KEY);
            
            document.getElementById('finalScoreText').textContent = t('oddOneOut.finalScore', { score: score });
            document.getElementById('highScoreText').textContent = t('oddOneOut.highScoreValue', { score: bestScore, player: bestPlayer });
            document.getElementById('playerDisplay').textContent = t('oddOneOut.playerGame', { name: playerName });
            document.getElementById('gameOver').style.display = 'block';
            loadHighScore();
        }
        
        // Initialize
        GameUtils.initSoundToggle();
        loadHighScore();
        setTimeout(() => startGame(), 500);
    </script>
    <script>
        // Add language toggle button
        if (typeof I18n !== 'undefined') {
            const langBtn = I18n.createLanguageToggle();
            document.body.appendChild(langBtn);
        }
    </script>
</body>
</html>
