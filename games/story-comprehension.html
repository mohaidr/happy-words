<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Google Analytics -->
    <script src="../js/analytics.js"></script>
    <script src="../js/i18n.js"></script>
    <title>ğŸ“– Story Time</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Baloo+Bhaijaan+2:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/games.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
        
        .game-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Story Selection */
        .story-select {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .story-card {
            background: linear-gradient(145deg, #fff, #f8f8f8);
            border-radius: 16px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 3px solid transparent;
        }
        
        .story-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .story-card.selected {
            border-color: #667eea;
            background: linear-gradient(145deg, #e8e4ff, #f0edff);
        }
        
        .story-card.completed {
            border-color: #10b981;
        }
        
        .story-card .story-icon {
            font-size: 40px;
            margin-bottom: 8px;
        }
        
        .story-card .story-title {
            font-size: 14px;
            font-weight: 600;
            color: #4a5568;
        }
        
        .story-card .story-score {
            font-size: 12px;
            color: #10b981;
            margin-top: 4px;
        }
        
        /* Story Display */
        .story-section {
            background: linear-gradient(145deg, #fff, #f8f8f8);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }
        
        .story-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px dashed #e2e8f0;
        }
        
        .story-name {
            font-size: 20px;
            font-weight: 700;
            color: #4a5568;
        }
        
        .story-icon-large {
            font-size: 36px;
        }
        
        .story-text {
            font-size: 18px;
            line-height: 1.8;
            color: #2d3748;
            text-align: justify;
        }
        
        .timer-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            margin-top: 20px;
            overflow: hidden;
        }
        
        .timer-progress {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 4px;
            transition: width 0.1s linear;
        }
        
        .timer-text {
            text-align: center;
            margin-top: 8px;
            font-size: 14px;
            color: #718096;
        }
        
        .read-instruction {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            padding: 12px 20px;
            border-radius: 12px;
            text-align: center;
            font-size: 16px;
            color: #92400e;
            margin-bottom: 16px;
        }
        
        /* Questions Section */
        .question-section {
            background: linear-gradient(145deg, #fff, #f8f8f8);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }
        
        .question-progress {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
        }
        
        .question-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e2e8f0;
            transition: all 0.3s ease;
        }
        
        .question-dot.current {
            background: #667eea;
            transform: scale(1.3);
        }
        
        .question-dot.answered {
            background: #10b981;
        }
        
        .question-dot.wrong {
            background: #ef4444;
        }
        
        .question-text {
            font-size: 20px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .answer-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .answer-option {
            background: linear-gradient(135deg, #f0f4ff, #e8edff);
            border: 3px solid #c7d2fe;
            border-radius: 14px;
            padding: 14px 20px;
            font-size: 16px;
            color: #4338ca;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .answer-option:hover {
            background: linear-gradient(135deg, #e0e7ff, #d0d9ff);
            transform: translateX(4px);
        }
        
        .answer-option.selected {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: #667eea;
            color: white;
        }
        
        .answer-option.correct {
            background: linear-gradient(135deg, #10b981, #059669);
            border-color: #10b981;
            color: white;
            animation: pulse 0.5s ease;
        }
        
        .answer-option.wrong {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border-color: #ef4444;
            color: white;
            animation: shake 0.3s ease;
        }
        
        .answer-option.show-correct {
            background: linear-gradient(135deg, #10b981, #059669);
            border-color: #10b981;
            color: white;
        }
        
        /* Results Section */
        .results-section {
            background: linear-gradient(145deg, #fff, #f8f8f8);
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }
        
        .results-header {
            text-align: center;
            margin-bottom: 24px;
        }
        
        .results-emoji {
            font-size: 60px;
            margin-bottom: 10px;
        }
        
        .results-title {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
        }
        
        .score-display {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            margin-bottom: 24px;
            color: white;
        }
        
        .score-number {
            font-size: 48px;
            font-weight: 700;
        }
        
        .score-label {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .review-section {
            margin-top: 24px;
        }
        
        .review-title {
            font-size: 18px;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 16px;
            text-align: center;
        }
        
        .review-item {
            background: #f7fafc;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border-left: 4px solid #e2e8f0;
        }
        
        .review-item.correct {
            border-left-color: #10b981;
            background: #f0fdf4;
        }
        
        .review-item.wrong {
            border-left-color: #ef4444;
            background: #fef2f2;
        }
        
        .review-question {
            font-size: 14px;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 8px;
        }
        
        .review-answer {
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .review-answer .icon {
            font-size: 16px;
        }
        
        .review-answer.user-answer {
            color: #718096;
        }
        
        .review-answer.correct-answer {
            color: #10b981;
            font-weight: 600;
        }
        
        /* Buttons */
        .btn-row {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .start-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            border-radius: 14px;
            padding: 14px 28px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }
        
        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
        }
        
        .back-btn {
            background: linear-gradient(135deg, #94a3b8, #64748b);
            color: white;
            border: none;
            border-radius: 14px;
            padding: 14px 28px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* Responsive */
        @media (max-width: 500px) {
            .story-select {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .story-text {
                font-size: 16px;
            }
            
            .question-text {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="top-bar">
        <a href="../home.html" class="home-btn" data-i18n="game.home">â† Home</a>
        <a href="category-reading.html" class="category-btn" data-i18n="nav.reading">ğŸ“š Reading</a>
        <h1>ğŸ“– <span data-i18n="storyGame.title">Story Time</span></h1>
    </div>
    
    <div class="stats">
        <div><span data-i18n="game.score">Score</span>: <span id="totalScore">0</span></div>
        <div>ğŸ“š <span data-i18n="storyGame.storiesCompleted">Stories</span>: <span id="storiesCompleted">0</span>/<span id="totalStories">10</span></div>
    </div>
    
    <div class="game-container">
        <!-- Story Selection Screen -->
        <div id="storySelectScreen">
            <p class="info" style="color: white; margin-bottom: 15px;" data-i18n="storyGame.selectStory">Choose a story to read!</p>
            <div class="story-select" id="storySelect"></div>
        </div>
        
        <!-- Story Reading Screen -->
        <div id="storyScreen" class="hidden">
            <div class="story-section">
                <div class="read-instruction" data-i18n="storyGame.readCarefully">ğŸ“š Read the story carefully!</div>
                <div class="story-header">
                    <span class="story-name" id="storyName"></span>
                    <span class="story-icon-large" id="storyIconLarge"></span>
                </div>
                <div class="story-text" id="storyText"></div>
                <div class="timer-bar">
                    <div class="timer-progress" id="timerProgress"></div>
                </div>
                <div class="timer-text" id="timerText"></div>
            </div>
            <div class="btn-row">
                <button class="start-btn" id="readyBtn" data-i18n="storyGame.imReady">âœ“ I'm Ready!</button>
                <button class="back-btn" id="backFromStoryBtn" data-i18n="storyGame.backToStories">â† Back</button>
            </div>
        </div>
        
        <!-- Questions Screen -->
        <div id="questionScreen" class="hidden">
            <div class="question-section">
                <div class="question-progress" id="questionProgress"></div>
                <div class="question-text" id="questionText"></div>
                <div class="answer-options" id="answerOptions"></div>
            </div>
        </div>
        
        <!-- Results Screen -->
        <div id="resultsScreen" class="hidden">
            <div class="results-section">
                <div class="results-header">
                    <div class="results-emoji" id="resultsEmoji">ğŸ‰</div>
                    <div class="results-title" id="resultsTitle" data-i18n="storyGame.greatJob">Great Job!</div>
                </div>
                <div class="score-display">
                    <div class="score-number" id="scoreNumber">0/4</div>
                    <div class="score-label" data-i18n="storyGame.correctAnswers">Correct Answers</div>
                </div>
                <div class="review-section">
                    <div class="review-title" data-i18n="storyGame.reviewAnswers">ğŸ“ Review Your Answers</div>
                    <div id="reviewList"></div>
                </div>
                <div class="btn-row">
                    <button class="start-btn" id="nextStoryBtn" data-i18n="storyGame.nextStory">ğŸ“– Next Story</button>
                    <button class="back-btn" id="backToSelectBtn" data-i18n="storyGame.chooseAnother">Choose Another</button>
                </div>
            </div>
        </div>
    </div>
    
    <p class="info" data-i18n="storyGame.instruction">Read stories and answer questions!</p>
    <p class="info" id="bestScoreDisplay">ğŸ† Best: --</p>

    <script src="../js/game-utils.js"></script>
    <script>
        const GAME_KEY = 'storyComprehension';
        
        // Color dictionary for dynamic color replacement
        const COLORS = {
            red: { en: 'red', ar: 'Ø£Ø­Ù…Ø±', arFem: 'Ø­Ù…Ø±Ø§Ø¡' },
            blue: { en: 'blue', ar: 'Ø£Ø²Ø±Ù‚', arFem: 'Ø²Ø±Ù‚Ø§Ø¡' },
            green: { en: 'green', ar: 'Ø£Ø®Ø¶Ø±', arFem: 'Ø®Ø¶Ø±Ø§Ø¡' },
            yellow: { en: 'yellow', ar: 'Ø£ØµÙØ±', arFem: 'ØµÙØ±Ø§Ø¡' },
            white: { en: 'white', ar: 'Ø£Ø¨ÙŠØ¶', arFem: 'Ø¨ÙŠØ¶Ø§Ø¡' },
            black: { en: 'black', ar: 'Ø£Ø³ÙˆØ¯', arFem: 'Ø³ÙˆØ¯Ø§Ø¡' },
            brown: { en: 'brown', ar: 'Ø¨Ù†ÙŠ', arFem: 'Ø¨Ù†ÙŠØ©' },
            pink: { en: 'pink', ar: 'ÙˆØ±Ø¯ÙŠ', arFem: 'ÙˆØ±Ø¯ÙŠØ©' },
            orange: { en: 'orange', ar: 'Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ', arFem: 'Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠØ©' },
            purple: { en: 'purple', ar: 'Ø¨Ù†ÙØ³Ø¬ÙŠ', arFem: 'Ø¨Ù†ÙØ³Ø¬ÙŠØ©' },
            gray: { en: 'gray', ar: 'Ø±Ù…Ø§Ø¯ÙŠ', arFem: 'Ø±Ù…Ø§Ø¯ÙŠØ©' }
        };
        
        const COLOR_KEYS = Object.keys(COLORS);
        
        // Semantic color groups - what colors make sense for different objects
        const SEMANTIC_COLORS = {
            // Nature
            mountain: ['brown', 'gray', 'white', 'green'],  // Real mountain colors
            water: ['blue', 'white'],  // Waterfall, river, lake
            sky: ['blue', 'gray', 'white'],
            grass: ['green'],
            
            // Animals
            rabbit: ['white', 'brown', 'gray'],
            fish: ['orange', 'blue', 'yellow', 'red', 'green', 'purple'],
            bird: ['blue', 'red', 'yellow', 'green', 'brown', 'orange'],
            
            // Clothing & accessories
            coat: ['red', 'blue', 'green', 'black', 'brown', 'gray', 'purple', 'orange'],
            umbrella: ['red', 'blue', 'green', 'yellow', 'purple', 'black', 'orange'],
            
            // Objects - most man-made items can be any color
            tent: ['red', 'blue', 'green', 'yellow', 'orange'],
            backpack: ['red', 'blue', 'green', 'yellow', 'purple', 'orange', 'black'],
            lunchbox: ['red', 'blue', 'green', 'yellow', 'purple', 'orange'],
            bike: ['red', 'blue', 'green', 'yellow', 'black', 'purple', 'orange'],
            watch: ['red', 'blue', 'green', 'yellow', 'black', 'purple', 'orange', 'white'],
            card: ['red', 'blue', 'green', 'yellow', 'purple', 'orange', 'white'],
            balloon: ['red', 'blue', 'green', 'yellow', 'purple', 'orange'],
            wool: ['blue', 'yellow', 'red', 'green', 'white', 'purple', 'orange']
        };
        
        // Number dictionary for dynamic number replacement
        // Arabic numbers 3-9: use arMasc with masculine nouns, arFem with feminine nouns
        // Note: Number 2 uses dual form (Ø§Ù„Ù…Ø«Ù†Ù‰) in Arabic, not counted here
        const NUMBERS = {
            3: { en: 'three', arMasc: 'Ø«Ù„Ø§Ø«Ø©', arFem: 'Ø«Ù„Ø§Ø«', value: 3 },
            4: { en: 'four', arMasc: 'Ø£Ø±Ø¨Ø¹Ø©', arFem: 'Ø£Ø±Ø¨Ø¹', value: 4 },
            5: { en: 'five', arMasc: 'Ø®Ù…Ø³Ø©', arFem: 'Ø®Ù…Ø³', value: 5 },
            6: { en: 'six', arMasc: 'Ø³ØªØ©', arFem: 'Ø³Øª', value: 6 },
            7: { en: 'seven', arMasc: 'Ø³Ø¨Ø¹Ø©', arFem: 'Ø³Ø¨Ø¹', value: 7 },
            8: { en: 'eight', arMasc: 'Ø«Ù…Ø§Ù†ÙŠØ©', arFem: 'Ø«Ù…Ø§Ù†ÙŠ', value: 8 },
            9: { en: 'nine', arMasc: 'ØªØ³Ø¹Ø©', arFem: 'ØªØ³Ø¹', value: 9 }
        };
        
        const NUMBER_KEYS = Object.keys(NUMBERS).map(Number);
        
        // Semantic number groups - what numbers make sense for different objects
        // Using only 3-9 for proper Arabic grammar (2 uses dual form Ø§Ù„Ù…Ø«Ù†Ù‰)
        const SEMANTIC_NUMBERS = {
            mountains: [3, 4, 5],              // 3-5 mountains in a drawing
            eggs: [3, 4, 5, 6],                // Reasonable for recipes
            apples: [3, 4, 5, 6, 7],           // Picking fruit
            spoons: [3, 4],                    // Recipe measurements
            minutes: [5, 7, 8, 9],             // Baking time (realistic minutes)
            books: [3, 4, 5],                  // Borrowing books
            friends: [3, 4, 5],                // Playing with friends
            gifts: [3, 4, 5, 6, 7, 8]          // Birthday gifts
        };
        
        // Ordinal numbers dictionary (for positions like "third seat")
        // Using 3-7 for Arabic grammar compatibility
        const ORDINALS = {
            3: { en: 'third', arMasc: 'Ø§Ù„Ø«Ø§Ù„Ø«', arFem: 'Ø§Ù„Ø«Ø§Ù„Ø«Ø©', value: 3 },
            4: { en: 'fourth', arMasc: 'Ø§Ù„Ø±Ø§Ø¨Ø¹', arFem: 'Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©', value: 4 },
            5: { en: 'fifth', arMasc: 'Ø§Ù„Ø®Ø§Ù…Ø³', arFem: 'Ø§Ù„Ø®Ø§Ù…Ø³Ø©', value: 5 },
            6: { en: 'sixth', arMasc: 'Ø§Ù„Ø³Ø§Ø¯Ø³', arFem: 'Ø§Ù„Ø³Ø§Ø¯Ø³Ø©', value: 6 },
            7: { en: 'seventh', arMasc: 'Ø§Ù„Ø³Ø§Ø¨Ø¹', arFem: 'Ø§Ù„Ø³Ø§Ø¨Ø¹Ø©', value: 7 }
        };
        
        const ORDINAL_KEYS = Object.keys(ORDINALS).map(Number);
        
        // Semantic ordinal groups
        const SEMANTIC_ORDINALS = {
            seats: [3, 4, 5, 6, 7]             // Bus/class seat positions
        };
        
        // Get random ordinal from allowed set
        function getRandomOrdinal(exclude = [], allowedOrdinals = null) {
            let available = allowedOrdinals || ORDINAL_KEYS;
            available = available.filter(n => !exclude.includes(n));
            const shuffled = [...available].sort(() => Math.random() - 0.5);
            return shuffled[0];
        }
        
        // Generate ordinal options for a question (correct + 3 wrong)
        function generateOrdinalOptions(correctOrd, useFeminine = false, semanticType = null) {
            let allowedOrdinals = semanticType ? SEMANTIC_ORDINALS[semanticType] : ORDINAL_KEYS;
            
            let wrongOrdinals = allowedOrdinals
                .filter(n => n !== correctOrd)
                .sort(() => Math.random() - 0.5)
                .slice(0, 3);
            
            const allOrdinals = [correctOrd, ...wrongOrdinals].sort((a, b) => a - b);
            const correctIndex = allOrdinals.indexOf(correctOrd);
            
            return {
                options: {
                    en: allOrdinals.map(n => ORDINALS[n].en.charAt(0).toUpperCase() + ORDINALS[n].en.slice(1)),
                    ar: allOrdinals.map(n => useFeminine ? ORDINALS[n].arFem : ORDINALS[n].arMasc)
                },
                correct: correctIndex
            };
        }
        
        // Apply ordinals to text
        function applyOrdinals(text, ordinalMap, lang) {
            let result = text;
            for (const [placeholder, ordKey] of Object.entries(ordinalMap)) {
                const ord = ORDINALS[ordKey];
                if (!ord) continue;
                result = result.replace(new RegExp(`{${placeholder}}`, 'g'), lang === 'ar' ? ord.arMasc : ord.en);
                result = result.replace(new RegExp(`{${placeholder}_fem}`, 'g'), ord.arFem);
                result = result.replace(new RegExp(`{${placeholder}_masc}`, 'g'), ord.arMasc);
            }
            return result;
        }
        
        // Get random numbers from allowed set
        function getRandomNumber(exclude = [], allowedNumbers = null) {
            let available = allowedNumbers || NUMBER_KEYS;
            available = available.filter(n => !exclude.includes(n));
            const shuffled = [...available].sort(() => Math.random() - 0.5);
            return shuffled[0];
        }
        
        // Generate number options for a question (correct + 3 wrong)
        function generateNumberOptions(correctNum, useFeminine = false, semanticType = null) {
            const correctValue = NUMBERS[correctNum].value;
            let allowedNumbers = semanticType ? SEMANTIC_NUMBERS[semanticType] : NUMBER_KEYS;
            
            // Get 3 wrong numbers, preferring nearby values
            let wrongNumbers = allowedNumbers
                .filter(n => n !== correctNum)
                .sort(() => Math.random() - 0.5)
                .slice(0, 3);
            
            const allNumbers = [correctNum, ...wrongNumbers].sort((a, b) => a - b);
            const correctIndex = allNumbers.indexOf(correctNum);
            
            return {
                options: {
                    en: allNumbers.map(n => NUMBERS[n].en.charAt(0).toUpperCase() + NUMBERS[n].en.slice(1)),
                    ar: allNumbers.map(n => useFeminine ? NUMBERS[n].arFem : NUMBERS[n].arMasc)
                },
                correct: correctIndex
            };
        }
        
        // Apply numbers to text
        function applyNumbers(text, numberMap, lang) {
            let result = text;
            for (const [placeholder, numKey] of Object.entries(numberMap)) {
                const num = NUMBERS[numKey];
                if (!num) continue;
                result = result.replace(new RegExp(`{${placeholder}}`, 'g'), lang === 'ar' ? num.arMasc : num.en);
                result = result.replace(new RegExp(`{${placeholder}_fem}`, 'g'), num.arFem);
                result = result.replace(new RegExp(`{${placeholder}_masc}`, 'g'), num.arMasc);
            }
            return result;
        }
        
        // Get random colors excluding specified ones, optionally from a specific group
        function getRandomColors(count, exclude = [], allowedColors = null) {
            let available = allowedColors || COLOR_KEYS;
            available = available.filter(c => !exclude.includes(c));
            const shuffled = [...available].sort(() => Math.random() - 0.5);
            return shuffled.slice(0, count);
        }
        
        // Get a single random color from allowed set
        function getRandomColor(exclude = [], allowedColors = null) {
            return getRandomColors(1, exclude, allowedColors)[0];
        }
        
        // Generate color options for a question (correct + 3 wrong)
        // semanticType limits wrong options to semantically appropriate colors
        function generateColorOptions(correctColor, useFeminine = false, semanticType = null) {
            const allowedColors = semanticType ? SEMANTIC_COLORS[semanticType] : COLOR_KEYS;
            const wrongColors = getRandomColors(3, [correctColor], allowedColors);
            const allColors = [correctColor, ...wrongColors].sort(() => Math.random() - 0.5);
            const correctIndex = allColors.indexOf(correctColor);
            
            return {
                options: {
                    en: allColors.map(c => COLORS[c].en.charAt(0).toUpperCase() + COLORS[c].en.slice(1)),
                    ar: allColors.map(c => useFeminine ? COLORS[c].arFem : COLORS[c].ar)
                },
                correct: correctIndex
            };
        }
        
        // Apply colors to text
        function applyColors(text, colorMap, lang, useFeminineAr = false) {
            let result = text;
            for (const [placeholder, colorKey] of Object.entries(colorMap)) {
                const color = COLORS[colorKey];
                const colorText = lang === 'ar' ? (useFeminineAr ? color.arFem : color.ar) : color.en;
                result = result.replace(new RegExp(`{${placeholder}}`, 'g'), colorText);
                result = result.replace(new RegExp(`{${placeholder}_fem}`, 'g'), color.arFem || color.ar);
                result = result.replace(new RegExp(`{${placeholder}_masc}`, 'g'), color.ar);
            }
            return result;
        }
        
        // Stories data with both Arabic and English
        const stories = [
            {
                id: 'artist',
                icon: 'ğŸ¨',
                title: {
                    en: 'The Creative Artist',
                    ar: 'Ø§Ù„Ø±Ø³Ø§Ù… Ø§Ù„Ù…Ø¨Ø¯Ø¹'
                },
                colorSlots: [
                    { name: 'mountainColor', type: 'mountain' },
                    { name: 'waterfallColor', type: 'water' },
                    { name: 'tentColor', type: 'tent' }
                ],
                numberSlots: [
                    { name: 'mountainCount', type: 'mountains' }
                ],
                text: {
                    en: 'Layla drew a large picture. She drew {mountainCount} {mountainColor} mountains and a {waterfallColor} waterfall flowing from the middle mountain. She placed a small {tentColor} tent under the tree, then she drew a single bird flying in the clear sky.',
                    ar: 'Ø±Ø³Ù…Øª Ù„ÙŠÙ„Ù‰ Ù„ÙˆØ­Ø© ÙƒØ¨ÙŠØ±Ø©. Ø±Ø³Ù…Øª {mountainCount_masc} Ø¬Ø¨Ø§Ù„ {mountainColor_fem}ØŒ ÙˆØ´Ù„Ø§Ù„Ø§Ù‹ {waterfallColor_masc} ÙŠÙ†Ø²Ù„ Ù…Ù† Ø§Ù„Ø¬Ø¨Ù„ Ø§Ù„Ø£ÙˆØ³Ø·. ÙˆØ¶Ø¹Øª Ø®ÙŠÙ…Ø© {tentColor_fem} ØµØºÙŠØ±Ø© ØªØ­Øª Ø§Ù„Ø´Ø¬Ø±Ø©ØŒ Ø«Ù… Ø±Ø³Ù…Øª Ø¹ØµÙÙˆØ±Ø§Ù‹ ÙˆØ­ÙŠØ¯Ø§Ù‹ ÙŠØ·ÙŠØ± ÙÙŠ Ø§Ù„Ø³Ù…Ø§Ø¡ Ø§Ù„ØµØ§ÙÙŠØ©.'
                },
                questions: [
                    {
                        text: { en: 'How many mountains did Layla draw?', ar: 'ÙƒÙ… Ø¬Ø¨Ù„Ù‹Ø§ Ø±Ø³Ù…Øª Ù„ÙŠÙ„Ù‰ØŸ' },
                        numberQuestion: 'mountainCount',
                        numberFeminine: false
                    },
                    {
                        text: { en: 'What color was the waterfall?', ar: 'Ù…Ø§ Ù„ÙˆÙ† Ø§Ù„Ø´Ù„Ø§Ù„ØŸ' },
                        colorQuestion: 'waterfallColor',
                        colorFeminine: false
                    },
                    {
                        text: { en: 'Where did she place the {tentColor} tent?', ar: 'Ø£ÙŠÙ† ÙˆØ¶Ø¹Øª Ø§Ù„Ø®ÙŠÙ…Ø© {tentColor_fem}ØŸ' },
                        options: {
                            en: ['On the mountain', 'Under the tree', 'By the waterfall', 'In the sky'],
                            ar: ['Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø¨Ù„', 'ØªØ­Øª Ø§Ù„Ø´Ø¬Ø±Ø©', 'Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø´Ù„Ø§Ù„', 'ÙÙŠ Ø§Ù„Ø³Ù…Ø§Ø¡']
                        },
                        correct: 1
                    },
                    {
                        text: { en: 'What was the bird doing in the drawing?', ar: 'Ù…Ø§Ø°Ø§ ÙƒØ§Ù† ÙŠÙØ¹Ù„ Ø§Ù„Ø¹ØµÙÙˆØ± ÙÙŠ Ø§Ù„Ø±Ø³Ù…Ø©ØŸ' },
                        options: {
                            en: ['Sitting on a tree', 'Flying in the sky', 'Swimming in water', 'Standing on mountain'],
                            ar: ['ÙŠØ¬Ù„Ø³ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø¬Ø±Ø©', 'ÙŠØ·ÙŠØ± ÙÙŠ Ø§Ù„Ø³Ù…Ø§Ø¡', 'ÙŠØ³Ø¨Ø­ ÙÙŠ Ø§Ù„Ù…Ø§Ø¡', 'ÙŠÙ‚Ù Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø¨Ù„']
                        },
                        correct: 1
                    }
                ]
            },
            {
                id: 'kitchen',
                icon: 'ğŸ°',
                title: {
                    en: 'The Busy Kitchen',
                    ar: 'Ø§Ù„Ù…Ø·Ø¨Ø® Ø§Ù„Ù…Ø²Ø¯Ø­Ù…'
                },
                numberSlots: [
                    { name: 'eggCount', type: 'eggs' }
                ],
                text: {
                    en: 'Grandmother was preparing an Eid cake. She put {eggCount} eggs in the large bowl, then added a cup of sugar and a spoonful of vanilla. Grandmother forgot to put the butter on the table, so she asked her grandson, Khaled, to get it from the fridge.',
                    ar: 'ÙƒØ§Ù†Øª Ø§Ù„Ø¬Ø¯Ø© ØªØ­Ø¶Ø± ÙƒØ¹ÙƒØ© Ø§Ù„Ø¹ÙŠØ¯. ÙˆØ¶Ø¹Øª {eggCount_fem} Ø¨ÙŠØ¶Ø§Øª ÙÙŠ Ø§Ù„ÙˆØ¹Ø§Ø¡ Ø§Ù„ÙƒØ¨ÙŠØ±ØŒ Ø«Ù… Ø£Ø¶Ø§ÙØª ÙƒÙˆØ¨Ø§Ù‹ Ù…Ù† Ø§Ù„Ø³ÙƒØ± ÙˆÙ…Ù„Ø¹Ù‚Ø© Ù…Ù† Ø§Ù„ÙØ§Ù†ÙŠÙ„ÙŠØ§. Ù†Ø³ÙŠØª Ø§Ù„Ø¬Ø¯Ø© ÙˆØ¶Ø¹ Ø§Ù„Ø²Ø¨Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø§ÙˆÙ„Ø©ØŒ ÙØ·Ù„Ø¨Øª Ù…Ù† Ø­ÙÙŠØ¯Ù‡Ø§ Ø®Ø§Ù„Ø¯ Ø£Ù† ÙŠØ­Ø¶Ø±Ù‡Ø§ Ù…Ù† Ø§Ù„Ø«Ù„Ø§Ø¬Ø©.'
                },
                questions: [
                    {
                        text: { en: 'How many eggs did Grandmother put in the bowl?', ar: 'ÙƒÙ… Ø¨ÙŠØ¶Ø© ÙˆØ¶Ø¹Øª Ø§Ù„Ø¬Ø¯Ø© ÙÙŠ Ø§Ù„ÙˆØ¹Ø§Ø¡ØŸ' },
                        numberQuestion: 'eggCount',
                        numberFeminine: true
                    },
                    {
                        text: { en: 'What did Grandmother add along with the sugar?', ar: 'Ù…Ø§Ø°Ø§ Ø£Ø¶Ø§ÙØª Ø§Ù„Ø¬Ø¯Ø© Ù…Ø¹ Ø§Ù„Ø³ÙƒØ±ØŸ' },
                        options: {
                            en: ['Milk', 'Vanilla', 'Chocolate', 'Honey'],
                            ar: ['Ø§Ù„Ø­Ù„ÙŠØ¨', 'Ø§Ù„ÙØ§Ù†ÙŠÙ„ÙŠØ§', 'Ø§Ù„Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©', 'Ø§Ù„Ø¹Ø³Ù„']
                        },
                        correct: 1
                    },
                    {
                        text: { en: 'What item did Grandmother forget on the table?', ar: 'Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ Ù†Ø³ÙŠØªÙ‡ Ø§Ù„Ø¬Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø§ÙˆÙ„Ø©ØŸ' },
                        options: {
                            en: ['Sugar', 'Eggs', 'Butter', 'Flour'],
                            ar: ['Ø§Ù„Ø³ÙƒØ±', 'Ø§Ù„Ø¨ÙŠØ¶', 'Ø§Ù„Ø²Ø¨Ø¯Ø©', 'Ø§Ù„Ø¯Ù‚ÙŠÙ‚']
                        },
                        correct: 2
                    },
                    {
                        text: { en: 'What is the name of the grandson who helped her?', ar: 'Ù…Ø§ Ø§Ø³Ù… Ø§Ù„Ø­ÙÙŠØ¯ Ø§Ù„Ø°ÙŠ Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø¬Ø¯Ø©ØŸ' },
                        options: {
                            en: ['Ahmed', 'Khaled', 'Omar', 'Ali'],
                            ar: ['Ø£Ø­Ù…Ø¯', 'Ø®Ø§Ù„Ø¯', 'Ø¹Ù…Ø±', 'Ø¹Ù„ÙŠ']
                        },
                        correct: 1
                    }
                ]
            },
            {
                id: 'library',
                icon: 'ğŸ“š',
                title: {
                    en: 'The Library Adventure',
                    ar: 'Ù…ØºØ§Ù…Ø±Ø© Ø§Ù„Ù…ÙƒØªØ¨Ø©'
                },
                colorSlots: [
                    { name: 'cardColor', type: 'card' }
                ],
                text: {
                    en: 'Amin went to the public library on Tuesday. He borrowed a book about dinosaurs and a short story about space. He put the two books in his backpack, but he lost his {cardColor} card near the science bookshelf. The security guard found it and gave it back to him at the door.',
                    ar: 'Ø°Ù‡Ø¨ Ø£Ù…ÙŠÙ† Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø¹Ø§Ù…Ø© ÙŠÙˆÙ… Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡. Ø§Ø³ØªØ¹Ø§Ø± ÙƒØªØ§Ø¨Ø§Ù‹ Ø¹Ù† Ø§Ù„Ø¯ÙŠÙ†Ø§ØµÙˆØ±Ø§Øª ÙˆÙ‚ØµØ© Ù‚ØµÙŠØ±Ø© Ø¹Ù† Ø§Ù„ÙØ¶Ø§Ø¡. ÙˆØ¶Ø¹ Ø§Ù„ÙƒØªØ§Ø¨ÙŠÙ† ÙÙŠ Ø¸Ù‡Ø±Ù‡ØŒ Ù„ÙƒÙ†Ù‡ Ø£Ø¶Ø§Ø¹ Ø¨Ø·Ø§Ù‚ØªÙ‡ Ø§Ù„{cardColor_fem} Ø¹Ù†Ø¯ Ø±Ù Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ø¹Ù„Ù…ÙŠØ©. ÙˆØ¬Ø¯Ù‡Ø§ Ø§Ù„Ø­Ø§Ø±Ø³ ÙˆØ£Ø¹Ø§Ø¯Ù‡Ø§ Ù„Ù‡ Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø§Ø¨.'
                },
                questions: [
                    {
                        text: { en: 'On which day did Amin go to the library?', ar: 'ÙÙŠ Ø£ÙŠ ÙŠÙˆÙ… Ø°Ù‡Ø¨ Ø£Ù…ÙŠÙ† Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙƒØªØ¨Ø©ØŸ' },
                        options: {
                            en: ['Monday', 'Tuesday', 'Wednesday', 'Thursday'],
                            ar: ['Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³']
                        },
                        correct: 1
                    },
                    {
                        text: { en: 'What was the book Amin borrowed about?', ar: 'Ø¹Ù† Ù…Ø§Ø°Ø§ ÙŠØªØ­Ø¯Ø« Ø§Ù„ÙƒØªØ§Ø¨ Ø§Ù„Ø°ÙŠ Ø§Ø³ØªØ¹Ø§Ø±Ù‡ Ø£Ù…ÙŠÙ†ØŸ' },
                        options: {
                            en: ['Animals', 'Dinosaurs', 'Cars', 'Plants'],
                            ar: ['Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª', 'Ø§Ù„Ø¯ÙŠÙ†Ø§ØµÙˆØ±Ø§Øª', 'Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª', 'Ø§Ù„Ù†Ø¨Ø§ØªØ§Øª']
                        },
                        correct: 1
                    },
                    {
                        text: { en: 'What color was the card that Amin lost?', ar: 'Ù…Ø§ Ù„ÙˆÙ† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªÙŠ Ø£Ø¶Ø§Ø¹Ù‡Ø§ Ø£Ù…ÙŠÙ†ØŸ' },
                        colorQuestion: 'cardColor',
                        colorFeminine: true
                    },
                    {
                        text: { en: 'Who found the card and returned it to him?', ar: 'Ù…Ù† Ø§Ù„Ø°ÙŠ ÙˆØ¬Ø¯ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ÙˆØ£Ø¹Ø§Ø¯Ù‡Ø§ Ù„Ù‡ØŸ' },
                        options: {
                            en: ['A student', 'The security guard', 'The librarian', 'His friend'],
                            ar: ['Ø·Ø§Ù„Ø¨', 'Ø§Ù„Ø­Ø§Ø±Ø³', 'Ø£Ù…ÙŠÙ† Ø§Ù„Ù…ÙƒØªØ¨Ø©', 'ØµØ¯ÙŠÙ‚Ù‡']
                        },
                        correct: 1
                    }
                ]
            },
            {
                id: 'rainy',
                icon: 'ğŸŒ§ï¸',
                title: {
                    en: 'The Rainy Day',
                    ar: 'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ù…Ø§Ø·Ø±'
                },
                colorSlots: [
                    { name: 'coatColor', type: 'coat' },
                    { name: 'umbrellaColor', type: 'umbrella' }
                ],
                text: {
                    en: 'It started to rain heavily. Majed put on his {coatColor} coat and black rubber boots. He carried a large {umbrellaColor} umbrella, but the strong wind flipped it inside out. Majed ran quickly and hid under the bus stop shelter until the rain stopped.',
                    ar: 'Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø·Ø± ÙŠØ³Ù‚Ø· Ø¨ØºØ²Ø§Ø±Ø©. Ù„Ø¨Ø³ Ù…Ø§Ø¬Ø¯ Ù…Ø¹Ø·ÙÙ‡ Ø§Ù„{coatColor_masc} ÙˆØ­Ø°Ø§Ø¡Ù‡ Ø§Ù„Ù…Ø·Ø§Ø·ÙŠ Ø§Ù„Ø£Ø³ÙˆØ¯. Ø­Ù…Ù„ Ù…Ø¸Ù„Ø© {umbrellaColor_fem} ÙƒØ¨ÙŠØ±Ø©ØŒ Ù„ÙƒÙ† Ø§Ù„Ù‡ÙˆØ§Ø¡ Ø§Ù„Ù‚ÙˆÙŠ Ù‚Ù„Ø¨ Ø§Ù„Ù…Ø¸Ù„Ø©. Ø±ÙƒØ¶ Ù…Ø§Ø¬Ø¯ Ø¨Ø³Ø±Ø¹Ø© ÙˆØ§Ø®ØªØ¨Ø£ ØªØ­Øª Ù…Ø¸Ù„Ø© Ø§Ù„Ø­Ø§ÙÙ„Ø© Ø­ØªÙ‰ ØªÙˆÙ‚Ù Ø§Ù„Ù…Ø·Ø±.'
                },
                questions: [
                    {
                        text: { en: 'What color was the coat Majed wore?', ar: 'Ù…Ø§ Ù„ÙˆÙ† Ø§Ù„Ù…Ø¹Ø·Ù Ø§Ù„Ø°ÙŠ Ù„Ø¨Ø³Ù‡ Ù…Ø§Ø¬Ø¯ØŸ' },
                        colorQuestion: 'coatColor',
                        colorFeminine: false
                    },
                    {
                        text: { en: 'What happened to the {umbrellaColor} umbrella?', ar: 'Ù…Ø§Ø°Ø§ Ø­Ø¯Ø« Ù„Ù„Ù…Ø¸Ù„Ø© Ø§Ù„{umbrellaColor_fem}ØŸ' },
                        options: {
                            en: ['It broke', 'The wind flipped it', 'He lost it', 'It flew away'],
                            ar: ['Ø§Ù†ÙƒØ³Ø±Øª', 'Ù‚Ù„Ø¨Ù‡Ø§ Ø§Ù„Ù‡ÙˆØ§Ø¡', 'Ø£Ø¶Ø§Ø¹Ù‡Ø§', 'Ø·Ø§Ø±Øª Ø¨Ø¹ÙŠØ¯Ø§Ù‹']
                        },
                        correct: 1
                    },
                    {
                        text: { en: 'Where did Majed hide from the rain?', ar: 'Ø£ÙŠÙ† Ø§Ø®ØªØ¨Ø£ Ù…Ø§Ø¬Ø¯ Ù…Ù† Ø§Ù„Ù…Ø·Ø±ØŸ' },
                        options: {
                            en: ['Under a tree', 'Under the bus stop shelter', 'Inside a shop', 'At home'],
                            ar: ['ØªØ­Øª Ø´Ø¬Ø±Ø©', 'ØªØ­Øª Ù…Ø¸Ù„Ø© Ø§Ù„Ø­Ø§ÙÙ„Ø©', 'Ø¯Ø§Ø®Ù„ Ù…ØªØ¬Ø±', 'ÙÙŠ Ø§Ù„Ø¨ÙŠØª']
                        },
                        correct: 1
                    },
                    {
                        text: { en: 'When did Majed leave his hiding spot?', ar: 'Ù…ØªÙ‰ Ø®Ø±Ø¬ Ù…Ø§Ø¬Ø¯ Ù…Ù† Ù…Ø®Ø¨Ø¦Ù‡ØŸ' },
                        options: {
                            en: ['When his mom called', 'When the bus came', 'When the rain stopped', 'When he got bored'],
                            ar: ['Ø¹Ù†Ø¯Ù…Ø§ Ù†Ø§Ø¯ØªÙ‡ Ø£Ù…Ù‡', 'Ø¹Ù†Ø¯Ù…Ø§ Ø¬Ø§Ø¡Øª Ø§Ù„Ø­Ø§ÙÙ„Ø©', 'Ø¹Ù†Ø¯Ù…Ø§ ØªÙˆÙ‚Ù Ø§Ù„Ù…Ø·Ø±', 'Ø¹Ù†Ø¯Ù…Ø§ Ø´Ø¹Ø± Ø¨Ø§Ù„Ù…Ù„Ù„']
                        },
                        correct: 2
                    }
                ]
            },
            {
                id: 'garden',
                icon: 'ğŸ',
                title: {
                    en: 'The Fruit Garden',
                    ar: 'Ø¨Ø³ØªØ§Ù† Ø§Ù„ÙÙˆØ§ÙƒÙ‡'
                },
                numberSlots: [
                    { name: 'appleCount', type: 'apples' }
                ],
                text: {
                    en: 'In the orchard, Maryam picked {appleCount} apples and put them in a wooden basket. She saw a small ladybug walking on a green leaf. Maryam called her brother Zaid to show him, but the ladybug flew away and hid behind a pear.',
                    ar: 'ÙÙŠ Ø§Ù„Ø¨Ø³ØªØ§Ù†ØŒ Ù‚Ø·ÙØª Ù…Ø±ÙŠÙ… {appleCount_fem} ØªÙØ§Ø­Ø§Øª ÙˆÙˆØ¶Ø¹ØªÙ‡Ø§ ÙÙŠ Ø³Ù„Ø© Ø®Ø´Ø¨ÙŠØ©. Ø±Ø£Øª Ø­Ø´Ø±Ø© Ø¯Ø¹Ø³ÙˆÙ‚Ø© ØµØºÙŠØ±Ø© ØªÙ…Ø´ÙŠ Ø¹Ù„Ù‰ ÙˆØ±Ù‚Ø© Ø´Ø¬Ø± Ø®Ø¶Ø±Ø§Ø¡. Ù†Ø§Ø¯Øª Ù…Ø±ÙŠÙ… Ø£Ø®ÙŠÙ‡Ø§ Ø²ÙŠØ¯ Ù„ØªØ±ÙŠÙ‡ØŒ Ù„ÙƒÙ† Ø§Ù„Ø¯Ø¹Ø³ÙˆÙ‚Ø© Ø·Ø§Ø±Øª ÙˆØ§Ø®ØªØ¨Ø£Øª Ø®Ù„Ù Ø«Ù…Ø±Ø© ÙƒÙ…Ø«Ø±Ù‰.'
                },
                questions: [
                    {
                        text: { en: 'How many apples did Maryam pick?', ar: 'ÙƒÙ… ØªÙØ§Ø­Ø© Ù‚Ø·ÙØª Ù…Ø±ÙŠÙ…ØŸ' },
                        numberQuestion: 'appleCount',
                        numberFeminine: true
                    },
                    {
                        text: { en: 'What was the ladybug doing when Maryam saw it?', ar: 'Ù…Ø§Ø°Ø§ ÙƒØ§Ù†Øª ØªÙØ¹Ù„ Ø§Ù„Ø¯Ø¹Ø³ÙˆÙ‚Ø© Ø¹Ù†Ø¯Ù…Ø§ Ø±Ø£ØªÙ‡Ø§ Ù…Ø±ÙŠÙ…ØŸ' },
                        options: {
                            en: ['Flying', 'Walking on a leaf', 'Sleeping', 'Eating'],
                            ar: ['ØªØ·ÙŠØ±', 'ØªÙ…Ø´ÙŠ Ø¹Ù„Ù‰ ÙˆØ±Ù‚Ø©', 'Ù†Ø§Ø¦Ù…Ø©', 'ØªØ£ÙƒÙ„']
                        },
                        correct: 1
                    },
                    {
                        text: { en: 'Who is the person Maryam called?', ar: 'Ù…Ù† Ù‡Ùˆ Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ø°ÙŠ Ù†Ø§Ø¯ØªÙ‡ Ù…Ø±ÙŠÙ…ØŸ' },
                        options: {
                            en: ['Her mother', 'Her sister', 'Her brother Zaid', 'Her father'],
                            ar: ['Ø£Ù…Ù‡Ø§', 'Ø£Ø®ØªÙ‡Ø§', 'Ø£Ø®ÙˆÙ‡Ø§ Ø²ÙŠØ¯', 'Ø£Ø¨ÙˆÙ‡Ø§']
                        },
                        correct: 2
                    },
                    {
                        text: { en: 'Where did the ladybug hide at the end?', ar: 'Ø£ÙŠÙ† Ø§Ø®ØªØ¨Ø£Øª Ø§Ù„Ø¯Ø¹Ø³ÙˆÙ‚Ø© ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©ØŸ' },
                        options: {
                            en: ['Behind an apple', 'Behind a pear', 'Under a leaf', 'On a flower'],
                            ar: ['Ø®Ù„Ù ØªÙØ§Ø­Ø©', 'Ø®Ù„Ù ÙƒÙ…Ø«Ø±Ù‰', 'ØªØ­Øª ÙˆØ±Ù‚Ø©', 'Ø¹Ù„Ù‰ Ø²Ù‡Ø±Ø©']
                        },
                        correct: 1
                    }
                ]
            },
            {
                id: 'schoolbus',
                icon: 'ğŸšŒ',
                title: {
                    en: 'The School Bus',
                    ar: 'Ø­Ø§ÙÙ„Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©'
                },
                colorSlots: [
                    { name: 'backpackColor', type: 'backpack' },
                    { name: 'lunchboxColor', type: 'lunchbox' }
                ],
                ordinalSlots: [
                    { name: 'seatNumber', type: 'seats' }
                ],
                text: {
                    en: 'Adam got on the yellow bus and sat in the {seatNumber} seat. He was carrying a {backpackColor} backpack with a {lunchboxColor} lunchbox inside. Adam forgot his umbrella under the seat when he got off, so the driver, Saeed, ran after him to return it.',
                    ar: 'Ø±ÙƒØ¨ Ø¢Ø¯Ù… Ø§Ù„Ø­Ø§ÙÙ„Ø© Ø§Ù„ØµÙØ±Ø§Ø¡ ÙˆØ¬Ù„Ø³ ÙÙŠ Ø§Ù„Ù…Ù‚Ø¹Ø¯ {seatNumber_masc}. ÙƒØ§Ù† ÙŠØ­Ù…Ù„ Ø­Ù‚ÙŠØ¨Ø© {backpackColor_fem} ÙˆØ¨Ø¯Ø§Ø®Ù„Ù‡Ø§ Ø¹Ù„Ø¨Ø© Ø·Ø¹Ø§Ù… {lunchboxColor_fem}. Ù†Ø³ÙŠ Ø¢Ø¯Ù… Ù…Ø¸Ù„ØªÙ‡ ØªØ­Øª Ø§Ù„ÙƒØ±Ø³ÙŠ Ø¹Ù†Ø¯Ù…Ø§ Ù†Ø²Ù„ØŒ ÙØ±ÙƒØ¶ Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø³Ø¹ÙŠØ¯ Ø®Ù„ÙÙ‡ Ù„ÙŠØ¹ÙŠØ¯Ù‡Ø§ Ù„Ù‡.'
                },
                questions: [
                    {
                        text: { en: 'Which seat did Adam sit in?', ar: 'ÙÙŠ Ø£ÙŠ Ù…Ù‚Ø¹Ø¯ Ø¬Ù„Ø³ Ø¢Ø¯Ù…ØŸ' },
                        ordinalQuestion: 'seatNumber',
                        ordinalFeminine: false
                    },
                    {
                        text: { en: 'What color was the lunchbox in his bag?', ar: 'Ù…Ø§ Ù„ÙˆÙ† Ø¹Ù„Ø¨Ø© Ø§Ù„Ø·Ø¹Ø§Ù… Ø§Ù„ØªÙŠ ÙƒØ§Ù†Øª ÙÙŠ Ø­Ù‚ÙŠØ¨ØªÙ‡ØŸ' },
                        colorQuestion: 'lunchboxColor',
                        colorFeminine: true
                    },
                    {
                        text: { en: 'What did Adam forget under the seat?', ar: 'Ù…Ø§Ø°Ø§ Ù†Ø³ÙŠ Ø¢Ø¯Ù… ØªØ­Øª Ø§Ù„ÙƒØ±Ø³ÙŠØŸ' },
                        options: {
                            en: ['His backpack', 'His lunchbox', 'His umbrella', 'His book'],
                            ar: ['Ø­Ù‚ÙŠØ¨ØªÙ‡', 'Ø¹Ù„Ø¨Ø© Ø·Ø¹Ø§Ù…Ù‡', 'Ù…Ø¸Ù„ØªÙ‡', 'ÙƒØªØ§Ø¨Ù‡']
                        },
                        correct: 2
                    },
                    {
                        text: { en: "What is the bus driver's name?", ar: 'Ù…Ø§ Ø§Ø³Ù… Ø³Ø§Ø¦Ù‚ Ø§Ù„Ø­Ø§ÙÙ„Ø©ØŸ' },
                        options: {
                            en: ['Adam', 'Saeed', 'Omar', 'Ali'],
                            ar: ['Ø¢Ø¯Ù…', 'Ø³Ø¹ÙŠØ¯', 'Ø¹Ù…Ø±', 'Ø¹Ù„ÙŠ']
                        },
                        correct: 1
                    }
                ]
            },
            {
                id: 'baker',
                icon: 'ğŸª',
                title: {
                    en: 'The Little Baker',
                    ar: 'Ø§Ù„Ø®Ø¨Ø§Ø² Ø§Ù„ØµØºÙŠØ±'
                },
                numberSlots: [
                    { name: 'spoonCount', type: 'spoons' },
                    { name: 'minuteCount', type: 'minutes' }
                ],
                text: {
                    en: 'Yassin decided to make chocolate cookies. He put {spoonCount} spoons of sugar and two cups of flour into a large bowl. He added dark chocolate chips at the end. He baked the cookies for {minuteCount} minutes, then took them out to cool on the window.',
                    ar: 'Ù‚Ø±Ø± ÙŠØ§Ø³ÙŠÙ† ØµÙ†Ø¹ Ø¨Ø³ÙƒÙˆÙŠØª Ø§Ù„Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©. ÙˆØ¶Ø¹ {spoonCount_fem} Ù…Ù„Ø§Ø¹Ù‚ Ù…Ù† Ø§Ù„Ø³ÙƒØ± ÙˆÙƒÙˆØ¨ÙŠÙ† Ù…Ù† Ø§Ù„Ø¯Ù‚ÙŠÙ‚ ÙÙŠ ÙˆØ¹Ø§Ø¡ ÙƒØ¨ÙŠØ±. Ø£Ø¶Ø§Ù Ø­Ø¨ÙŠØ¨Ø§Øª Ø§Ù„Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ© Ø§Ù„Ø¯Ø§ÙƒÙ†Ø© ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©. Ø®Ø¨Ø² Ø§Ù„Ø¨Ø³ÙƒÙˆÙŠØª Ù„Ù…Ø¯Ø© {minuteCount_fem} Ø¯Ù‚Ø§Ø¦Ù‚ØŒ Ø«Ù… Ø£Ø®Ø±Ø¬Ù‡ Ù„ÙŠØ¨Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø§ÙØ°Ø©.'
                },
                questions: [
                    {
                        text: { en: 'How many spoons of sugar did Yassin put in?', ar: 'ÙƒÙ… Ù…Ù„Ø¹Ù‚Ø© Ø³ÙƒØ± ÙˆØ¶Ø¹ ÙŠØ§Ø³ÙŠÙ†ØŸ' },
                        numberQuestion: 'spoonCount',
                        numberFeminine: true
                    },
                    {
                        text: { en: 'What did Yassin add at the very end?', ar: 'Ù…Ø§Ø°Ø§ Ø£Ø¶Ø§Ù ÙŠØ§Ø³ÙŠÙ† ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©ØŸ' },
                        options: {
                            en: ['Sugar', 'Flour', 'Dark chocolate chips', 'Milk'],
                            ar: ['Ø§Ù„Ø³ÙƒØ±', 'Ø§Ù„Ø¯Ù‚ÙŠÙ‚', 'Ø­Ø¨ÙŠØ¨Ø§Øª Ø§Ù„Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ© Ø§Ù„Ø¯Ø§ÙƒÙ†Ø©', 'Ø§Ù„Ø­Ù„ÙŠØ¨']
                        },
                        correct: 2
                    },
                    {
                        text: { en: 'How many minutes did it take to bake the cookies?', ar: 'ÙƒÙ… Ø¯Ù‚ÙŠÙ‚Ø© Ø§Ø³ØªØºØ±Ù‚ Ø®Ø¨Ø² Ø§Ù„Ø¨Ø³ÙƒÙˆÙŠØªØŸ' },
                        numberQuestion: 'minuteCount',
                        numberFeminine: true
                    },
                    {
                        text: { en: 'Where did he put the cookies to cool down?', ar: 'Ø£ÙŠÙ† ÙˆØ¶Ø¹ Ø§Ù„Ø¨Ø³ÙƒÙˆÙŠØª Ù„ÙŠØ¨Ø±Ø¯ØŸ' },
                        options: {
                            en: ['On the table', 'On the window', 'In the fridge', 'On the floor'],
                            ar: ['Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø§ÙˆÙ„Ø©', 'Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø§ÙØ°Ø©', 'ÙÙŠ Ø§Ù„Ø«Ù„Ø§Ø¬Ø©', 'Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¶']
                        },
                        correct: 1
                    }
                ]
            },
            {
                id: 'kitten',
                icon: 'ğŸ±',
                title: {
                    en: 'The Lost Kitten',
                    ar: 'Ø§Ù„Ù‚Ø·Ø© Ø§Ù„Ø¶Ø§Ø¦Ø¹Ø©'
                },
                colorSlots: [
                    { name: 'woolColor', type: 'wool' }
                ],
                text: {
                    en: 'Sama looked for her kitten "Mishmish" everywhere. She looked behind the sofa but didn\'t find her, then she looked inside the wooden box and found only a {woolColor} wool ball. Finally, she heard a sound from the kitchen, and found the kitten sleeping on top of the fridge.',
                    ar: 'Ø¨Ø­Ø«Øª Ø³Ù…Ø§ Ø¹Ù† Ù‚Ø·ØªÙ‡Ø§ "Ù…Ø´Ù…Ø´" ÙÙŠ ÙƒÙ„ Ù…ÙƒØ§Ù†. Ù†Ø¸Ø±Øª Ø®Ù„Ù Ø§Ù„Ø£Ø±ÙŠÙƒØ© ÙˆÙ„Ù… ØªØ¬Ø¯Ù‡Ø§ØŒ Ø«Ù… Ù†Ø¸Ø±Øª Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø®Ø´Ø¨ÙŠ ÙˆÙˆØ¬Ø¯Øª ÙÙ‚Ø· ÙƒØ±Ø© ØµÙˆÙ {woolColor_fem}. Ø£Ø®ÙŠØ±Ø§Ù‹ØŒ Ø³Ù…Ø¹Øª ØµÙˆØªØ§Ù‹ Ù…Ù† Ø§Ù„Ù…Ø·Ø¨Ø®ØŒ ÙˆÙˆØ¬Ø¯Øª Ø§Ù„Ù‚Ø·Ø© Ù†Ø§Ø¦Ù…Ø© ÙÙˆÙ‚ Ø§Ù„Ø«Ù„Ø§Ø¬Ø©.'
                },
                questions: [
                    {
                        text: { en: 'What is the name of the kitten Sama was looking for?', ar: 'Ù…Ø§ Ø§Ø³Ù… Ø§Ù„Ù‚Ø·Ø© Ø§Ù„ØªÙŠ ÙƒØ§Ù†Øª ØªØ¨Ø­Ø« Ø¹Ù†Ù‡Ø§ Ø³Ù…Ø§ØŸ' },
                        options: {
                            en: ['Fluffy', 'Mishmish', 'Kitty', 'Coco'],
                            ar: ['ÙÙ„Ø§ÙÙŠ', 'Ù…Ø´Ù…Ø´', 'ÙƒÙŠØªÙŠ', 'ÙƒÙˆÙƒÙˆ']
                        },
                        correct: 1
                    },
                    {
                        text: { en: 'What did Sama find inside the wooden box?', ar: 'Ù…Ø§Ø°Ø§ ÙˆØ¬Ø¯Øª Ø³Ù…Ø§ Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø®Ø´Ø¨ÙŠØŸ' },
                        options: {
                            en: ['The kitten', 'A {woolColor} wool ball', 'A toy', 'Nothing'],
                            ar: ['Ø§Ù„Ù‚Ø·Ø©', 'ÙƒØ±Ø© ØµÙˆÙ {woolColor_fem}', 'Ù„Ø¹Ø¨Ø©', 'Ù„Ø§ Ø´ÙŠØ¡']
                        },
                        correct: 1
                    },
                    {
                        text: { en: 'Which room did Sama hear a sound from?', ar: 'Ù…Ù† Ø£ÙŠ ØºØ±ÙØ© Ø³Ù…Ø¹Øª Ø³Ù…Ø§ ØµÙˆØªØ§Ù‹ØŸ' },
                        options: {
                            en: ['Bedroom', 'Bathroom', 'Kitchen', 'Living room'],
                            ar: ['ØºØ±ÙØ© Ø§Ù„Ù†ÙˆÙ…', 'Ø§Ù„Ø­Ù…Ø§Ù…', 'Ø§Ù„Ù…Ø·Ø¨Ø®', 'ØºØ±ÙØ© Ø§Ù„Ù…Ø¹ÙŠØ´Ø©']
                        },
                        correct: 2
                    },
                    {
                        text: { en: 'Where was the kitten sleeping at the end?', ar: 'Ø£ÙŠÙ† ÙƒØ§Ù†Øª Ø§Ù„Ù‚Ø·Ø© Ù†Ø§Ø¦Ù…Ø© ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©ØŸ' },
                        options: {
                            en: ['On the sofa', 'In the box', 'On top of the fridge', 'Under the bed'],
                            ar: ['Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±ÙŠÙƒØ©', 'ÙÙŠ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚', 'ÙÙˆÙ‚ Ø§Ù„Ø«Ù„Ø§Ø¬Ø©', 'ØªØ­Øª Ø§Ù„Ø³Ø±ÙŠØ±']
                        },
                        correct: 2
                    }
                ]
            },
            {
                id: 'rainygarden',
                icon: 'ğŸŒ§ï¸',
                title: {
                    en: 'The Rainy Garden',
                    ar: 'Ø­Ø¯ÙŠÙ‚Ø© Ø§Ù„Ù…Ø·Ø±'
                },
                text: {
                    en: 'Karim went out to the garden after the rain. He saw a small snail crawling on the stone garden wall. There were four butterflies flying around a sunflower. Karim picked a wide leaf to cover the snail from the water drops falling from the tree.',
                    ar: 'Ø®Ø±Ø¬ ÙƒØ±ÙŠÙ… Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø¯ÙŠÙ‚Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø·Ø±. Ø±Ø£Ù‰ Ø­Ù„Ø²ÙˆÙ†Ø§Ù‹ ØµØºÙŠØ±Ø§Ù‹ ÙŠØ²Ø­Ù Ø¹Ù„Ù‰ Ø³ÙˆØ± Ø§Ù„Ø­Ø¯ÙŠÙ‚Ø© Ø§Ù„Ø­Ø¬Ø±ÙŠ. ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ø£Ø±Ø¨Ø¹ ÙØ±Ø§Ø´Ø§Øª ØªØ·ÙŠØ± Ø­ÙˆÙ„ Ø²Ù‡Ø±Ø© Ø¯ÙˆØ§Ø± Ø§Ù„Ø´Ù…Ø³. Ù‚Ø·Ù ÙƒØ±ÙŠÙ… ÙˆØ±Ù‚Ø© Ø´Ø¬Ø± Ø¹Ø±ÙŠØ¶Ø© Ù„ÙŠØºØ·ÙŠ Ø¨Ù‡Ø§ Ø§Ù„Ø­Ù„Ø²ÙˆÙ† Ù…Ù† Ù‚Ø·Ø±Ø§Øª Ø§Ù„Ù…Ø§Ø¡ Ø§Ù„Ù…ØªØ³Ø§Ù‚Ø·Ø© Ù…Ù† Ø§Ù„Ø´Ø¬Ø±Ø©.'
                },
                questions: [
                    {
                        text: { en: 'Where was the snail crawling?', ar: 'Ø£ÙŠÙ† ÙƒØ§Ù† ÙŠØ²Ø­Ù Ø§Ù„Ø­Ù„Ø²ÙˆÙ†ØŸ' },
                        options: {
                            en: ['On a flower', 'On the stone wall', 'On a leaf', 'On the ground'],
                            ar: ['Ø¹Ù„Ù‰ Ø²Ù‡Ø±Ø©', 'Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙˆØ± Ø§Ù„Ø­Ø¬Ø±ÙŠ', 'Ø¹Ù„Ù‰ ÙˆØ±Ù‚Ø©', 'Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¶']
                        },
                        correct: 1
                    },
                    {
                        text: { en: 'How many butterflies did Karim see?', ar: 'ÙƒÙ… Ø¹Ø¯Ø¯ Ø§Ù„ÙØ±Ø§Ø´Ø§Øª Ø§Ù„ØªÙŠ Ø±Ø¢Ù‡Ø§ ÙƒØ±ÙŠÙ…ØŸ' },
                        options: {
                            en: ['Two', 'Three', 'Four', 'Five'],
                            ar: ['Ø§Ø«Ù†ØªØ§Ù†', 'Ø«Ù„Ø§Ø«', 'Ø£Ø±Ø¨Ø¹', 'Ø®Ù…Ø³']
                        },
                        correct: 2
                    },
                    {
                        text: { en: 'Which flower were the butterflies flying around?', ar: 'Ø­ÙˆÙ„ Ø£ÙŠ Ø²Ù‡Ø±Ø© ÙƒØ§Ù†Øª Ø§Ù„ÙØ±Ø§Ø´Ø§Øª ØªØ·ÙŠØ±ØŸ' },
                        options: {
                            en: ['Rose', 'Tulip', 'Sunflower', 'Daisy'],
                            ar: ['ÙˆØ±Ø¯Ø©', 'ØªÙˆÙ„ÙŠØ¨', 'Ø¯ÙˆØ§Ø± Ø§Ù„Ø´Ù…Ø³', 'Ø£Ù‚Ø­ÙˆØ§Ù†']
                        },
                        correct: 2
                    },
                    {
                        text: { en: 'Why did Karim pick the wide leaf?', ar: 'Ù„Ù…Ø§Ø°Ø§ Ù‚Ø·Ù ÙƒØ±ÙŠÙ… ÙˆØ±Ù‚Ø© Ø§Ù„Ø´Ø¬Ø± Ø§Ù„Ø¹Ø±ÙŠØ¶Ø©ØŸ' },
                        options: {
                            en: ['To play with it', 'To cover the snail from water', 'To give to his mom', 'To collect it'],
                            ar: ['Ù„ÙŠÙ„Ø¹Ø¨ Ø¨Ù‡Ø§', 'Ù„ÙŠØºØ·ÙŠ Ø§Ù„Ø­Ù„Ø²ÙˆÙ† Ù…Ù† Ø§Ù„Ù…Ø§Ø¡', 'Ù„ÙŠØ¹Ø·ÙŠÙ‡Ø§ Ù„Ø£Ù…Ù‡', 'Ù„ÙŠØ¬Ù…Ø¹Ù‡Ø§']
                        },
                        correct: 1
                    }
                ]
            },
            {
                id: 'birthday',
                icon: 'ğŸ',
                title: {
                    en: 'The Birthday Present',
                    ar: 'Ù‡Ø¯ÙŠØ© Ø¹ÙŠØ¯ Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯'
                },
                colorSlots: [
                    { name: 'bikeColor', type: 'bike' },
                    { name: 'watchColor', type: 'watch' }
                ],
                numberSlots: [
                    { name: 'giftCount', type: 'gifts' }
                ],
                text: {
                    en: 'On her birthday, Layan received {giftCount} wrapped gifts. The large gift was a {bikeColor} bicycle, and the medium gift was a coloring set. As for the small gift given to her by her brother Omar, it was a {watchColor} wristwatch.',
                    ar: 'ÙÙŠ Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯Ù‡Ø§ØŒ Ø­ØµÙ„Øª Ù„ÙŠØ§Ù† Ø¹Ù„Ù‰ {giftCount_fem} Ù‡Ø¯Ø§ÙŠØ§ Ù…ØºÙ„ÙØ©. Ø§Ù„Ù‡Ø¯ÙŠØ© Ø§Ù„ÙƒØ¨ÙŠØ±Ø© ÙƒØ§Ù†Øª Ø¯Ø±Ø§Ø¬Ø© {bikeColor_fem}ØŒ ÙˆØ§Ù„Ù‡Ø¯ÙŠØ© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø© ÙƒØ§Ù†Øª Ù…Ø¬Ù…ÙˆØ¹Ø© ØªÙ„ÙˆÙŠÙ†. Ø£Ù…Ø§ Ø§Ù„Ù‡Ø¯ÙŠØ© Ø§Ù„ØµØºÙŠØ±Ø© Ø§Ù„ØªÙŠ Ø£Ø¹Ø·Ø§Ù‡Ø§ Ù„Ù‡Ø§ Ø£Ø®ÙˆÙ‡Ø§ Ø¹Ù…Ø±ØŒ ÙÙƒØ§Ù†Øª Ø¹Ø¨Ø§Ø±Ø© Ø¹Ù† Ø³Ø§Ø¹Ø© ÙŠØ¯ {watchColor_fem}.'
                },
                questions: [
                    {
                        text: { en: 'How many gifts did Layan receive?', ar: 'ÙƒÙ… Ø¹Ø¯Ø¯ Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ Ø§Ù„ØªÙŠ Ø­ØµÙ„Øª Ø¹Ù„ÙŠÙ‡Ø§ Ù„ÙŠØ§Ù†ØŸ' },
                        numberQuestion: 'giftCount',
                        numberFeminine: true
                    },
                    {
                        text: { en: 'What was the large gift?', ar: 'Ù…Ø§Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù‡Ø¯ÙŠØ© Ø§Ù„ÙƒØ¨ÙŠØ±Ø©ØŸ' },
                        options: {
                            en: ['A doll', 'A {bikeColor} bicycle', 'A coloring set', 'A wristwatch'],
                            ar: ['Ø¯Ù…ÙŠØ©', 'Ø¯Ø±Ø§Ø¬Ø© {bikeColor_fem}', 'Ù…Ø¬Ù…ÙˆØ¹Ø© ØªÙ„ÙˆÙŠÙ†', 'Ø³Ø§Ø¹Ø© ÙŠØ¯']
                        },
                        correct: 1
                    },
                    {
                        text: { en: 'Who gave Layan the small gift?', ar: 'Ù…Ù† Ø§Ù„Ø°ÙŠ Ø£Ø¹Ø·Ù‰ Ù„ÙŠØ§Ù† Ø§Ù„Ù‡Ø¯ÙŠØ© Ø§Ù„ØµØºÙŠØ±Ø©ØŸ' },
                        options: {
                            en: ['Her mother', 'Her father', 'Her brother Omar', 'Her friend'],
                            ar: ['Ø£Ù…Ù‡Ø§', 'Ø£Ø¨ÙˆÙ‡Ø§', 'Ø£Ø®ÙˆÙ‡Ø§ Ø¹Ù…Ø±', 'ØµØ¯ÙŠÙ‚ØªÙ‡Ø§']
                        },
                        correct: 2
                    },
                    {
                        text: { en: 'What color was the wristwatch she got?', ar: 'Ù…Ø§ Ù„ÙˆÙ† Ø³Ø§Ø¹Ø© Ø§Ù„ÙŠØ¯ Ø§Ù„ØªÙŠ Ø­ØµÙ„Øª Ø¹Ù„ÙŠÙ‡Ø§ØŸ' },
                        colorQuestion: 'watchColor',
                        colorFeminine: true
                    }
                ]
            }
        ];
        
        // KG Stories - Simpler, shorter stories for kindergarten
        const kgStories = [
            {
                id: 'kg_rabbit',
                icon: 'ğŸ°',
                title: {
                    en: 'The Hungry Rabbit',
                    ar: 'Ø§Ù„Ø£Ø±Ù†Ø¨ Ø§Ù„Ø¬Ø§Ø¦Ø¹'
                },
                colorSlots: [
                    { name: 'rabbitColor', type: 'rabbit' }
                ],
                text: {
                    en: 'The {rabbitColor} rabbit saw a big carrot under the tree. The rabbit ate the carrot and then drank some cold water. The rabbit slept in his small house.',
                    ar: 'Ø±Ø£Ù‰ Ø§Ù„Ø£Ø±Ù†Ø¨ Ø§Ù„{rabbitColor_masc} Ø¬Ø²Ø±Ø© ÙƒØ¨ÙŠØ±Ø© ØªØ­Øª Ø§Ù„Ø´Ø¬Ø±Ø©. Ø£ÙƒÙ„ Ø§Ù„Ø£Ø±Ù†Ø¨ Ø§Ù„Ø¬Ø²Ø±Ø© Ø«Ù… Ø´Ø±Ø¨ Ù…Ø§Ø¡Ù‹ Ø¨Ø§Ø±Ø¯Ø§Ù‹. Ù†Ø§Ù… Ø§Ù„Ø£Ø±Ù†Ø¨ ÙÙŠ Ø¨ÙŠØªÙ‡ Ø§Ù„ØµØºÙŠØ±.'
                },
                questions: [
                    {
                        text: { en: 'What color is the rabbit?', ar: 'Ù…Ø§ Ù„ÙˆÙ† Ø§Ù„Ø£Ø±Ù†Ø¨ØŸ' },
                        colorQuestion: 'rabbitColor',
                        colorFeminine: false
                    },
                    {
                        text: { en: 'What did the rabbit find under the tree?', ar: 'Ù…Ø§Ø°Ø§ ÙˆØ¬Ø¯ Ø§Ù„Ø£Ø±Ù†Ø¨ ØªØ­Øª Ø§Ù„Ø´Ø¬Ø±Ø©ØŸ' },
                        options: {
                            en: ['An apple', 'A carrot', 'A ball', 'A flower'],
                            ar: ['ØªÙØ§Ø­Ø©', 'Ø¬Ø²Ø±Ø©', 'ÙƒØ±Ø©', 'Ø²Ù‡Ø±Ø©']
                        },
                        correct: 1
                    },
                    {
                        text: { en: 'What did the rabbit drink?', ar: 'Ù…Ø§Ø°Ø§ Ø´Ø±Ø¨ Ø§Ù„Ø£Ø±Ù†Ø¨ØŸ' },
                        options: {
                            en: ['Milk', 'Juice', 'Water', 'Tea'],
                            ar: ['Ø­Ù„ÙŠØ¨', 'Ø¹ØµÙŠØ±', 'Ù…Ø§Ø¡', 'Ø´Ø§ÙŠ']
                        },
                        correct: 2
                    },
                    {
                        text: { en: 'Where did the rabbit sleep?', ar: 'Ø£ÙŠÙ† Ù†Ø§Ù… Ø§Ù„Ø£Ø±Ù†Ø¨ØŸ' },
                        options: {
                            en: ['Under the tree', 'In his house', 'On the grass', 'In the garden'],
                            ar: ['ØªØ­Øª Ø§Ù„Ø´Ø¬Ø±Ø©', 'ÙÙŠ Ø¨ÙŠØªÙ‡', 'Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø´Ø¨', 'ÙÙŠ Ø§Ù„Ø­Ø¯ÙŠÙ‚Ø©']
                        },
                        correct: 1
                    }
                ]
            },
            {
                id: 'kg_balloon',
                icon: 'ğŸˆ',
                title: {
                    en: 'The Colorful Balloon',
                    ar: 'Ø§Ù„Ø¨Ø§Ù„ÙˆÙ† Ø§Ù„Ù…Ù„ÙˆÙ†'
                },
                colorSlots: [
                    { name: 'balloonColor', type: 'balloon' }
                ],
                text: {
                    en: 'Bassem bought a {balloonColor} balloon. The balloon flew high in the air. Dad caught the balloon and gave it to Bassem. Bassem laughed and said, "Thank you."',
                    ar: 'Ø§Ø´ØªØ±Øª Ù„ÙŠÙ† Ø¨Ø§Ù„ÙˆÙ†Ø§Ù‹ {balloonColor_masc}. Ø·Ø§Ø± Ø§Ù„Ø¨Ø§Ù„ÙˆÙ† Ø¹Ø§Ù„ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ù‡ÙˆØ§Ø¡. Ø£Ù…Ø³Ùƒ Ø§Ù„Ø£Ø¨ Ø¨Ø§Ù„Ø¨Ø§Ù„ÙˆÙ† ÙˆØ£Ø¹Ø·Ø§Ù‡ Ù„Ø¨Ø§Ø³Ù…. Ø¶Ø­Ùƒ Ø¨Ø§Ø³Ù… ÙˆÙ‚Ø§Ù„: Ø´ÙƒØ±Ø§Ù‹.'
                },
                questions: [
                    {
                        text: { en: 'What color was the balloon?', ar: 'Ù…Ø§ Ù„ÙˆÙ† Ø§Ù„Ø¨Ø§Ù„ÙˆÙ†ØŸ' },
                        colorQuestion: 'balloonColor',
                        colorFeminine: false
                    },
                    {
                        text: { en: 'Where did the balloon fly?', ar: 'Ø£ÙŠÙ† Ø·Ø§Ø± Ø§Ù„Ø¨Ø§Ù„ÙˆÙ†ØŸ' },
                        options: {
                            en: ['On the ground', 'High in the air', 'In the water', 'Under the table'],
                            ar: ['Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¶', 'Ø¹Ø§Ù„ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ù‡ÙˆØ§Ø¡', 'ÙÙŠ Ø§Ù„Ù…Ø§Ø¡', 'ØªØ­Øª Ø§Ù„Ø·Ø§ÙˆÙ„Ø©']
                        },
                        correct: 1
                    },
                    {
                        text: { en: 'Who caught the balloon?', ar: 'Ù…Ù† Ø§Ù„Ø°ÙŠ Ø£Ù…Ø³Ùƒ Ø¨Ø§Ù„Ø¨Ø§Ù„ÙˆÙ†ØŸ' },
                        options: {
                            en: ['Mom', 'Dad', 'Sister', 'Brother'],
                            ar: ['Ø§Ù„Ø£Ù…', 'Ø§Ù„Ø£Ø¨', 'Ø§Ù„Ø£Ø®Øª', 'Ø§Ù„Ø£Ø®']
                        },
                        correct: 1
                    },
                    {
                        text: { en: 'What did Bassem say to his dad?', ar: 'Ù…Ø§Ø°Ø§ Ù‚Ø§Ù„ Ø¨Ø§Ø³Ù… Ù„Ø£Ø¨ÙŠÙ‡ØŸ' },
                        options: {
                            en: ['Goodbye', 'Thank you', 'Hello', 'Sorry'],
                            ar: ['Ù…Ø¹ Ø§Ù„Ø³Ù„Ø§Ù…Ø©', 'Ø´ÙƒØ±Ø§Ù‹', 'Ù…Ø±Ø­Ø¨Ø§', 'Ø¢Ø³Ù']
                        },
                        correct: 1
                    }
                ]
            },
            {
                id: 'kg_fish',
                icon: 'ğŸŸ',
                title: {
                    en: 'Fish in the Water',
                    ar: 'Ø§Ù„Ø³Ù…ÙƒØ© ÙÙŠ Ø§Ù„Ù…Ø§Ø¡'
                },
                colorSlots: [
                    { name: 'fish1Color', type: 'fish' },
                    { name: 'fish2Color', type: 'fish' }
                ],
                text: {
                    en: 'In the sea, there is a small {fish1Color} fish. The fish swims next to a big rock. The fish saw her friend, the {fish2Color} fish, and they played together in the sand.',
                    ar: 'ÙÙŠ Ø§Ù„Ø¨Ø­Ø± Ø³Ù…ÙƒØ© {fish1Color_fem} ØµØºÙŠØ±Ø©. ØªØ³Ø¨Ø­ Ø§Ù„Ø³Ù…ÙƒØ© Ø¨Ø¬Ø§Ù†Ø¨ ØµØ®Ø±Ø© ÙƒØ¨ÙŠØ±Ø©. Ø±Ø£Øª Ø§Ù„Ø³Ù…ÙƒØ© ØµØ¯ÙŠÙ‚ØªÙ‡Ø§ Ø§Ù„Ø³Ù…ÙƒØ© {fish2Color_fem} ÙˆÙ„Ø¹Ø¨ØªØ§ Ù…Ø¹Ø§Ù‹ ÙÙŠ Ø§Ù„Ø±Ù…Ù„.'
                },
                questions: [
                    {
                        text: { en: 'What color is the small fish?', ar: 'Ù…Ø§ Ù„ÙˆÙ† Ø§Ù„Ø³Ù…ÙƒØ© Ø§Ù„ØµØºÙŠØ±Ø©ØŸ' },
                        colorQuestion: 'fish1Color',
                        colorFeminine: true
                    },
                    {
                        text: { en: 'Where was the fish swimming?', ar: 'Ø£ÙŠÙ† ÙƒØ§Ù†Øª ØªØ³Ø¨Ø­ Ø§Ù„Ø³Ù…ÙƒØ©ØŸ' },
                        options: {
                            en: ['Next to a tree', 'Next to a rock', 'Next to a house', 'Next to a flower'],
                            ar: ['Ø¨Ø¬Ø§Ù†Ø¨ Ø´Ø¬Ø±Ø©', 'Ø¨Ø¬Ø§Ù†Ø¨ ØµØ®Ø±Ø©', 'Ø¨Ø¬Ø§Ù†Ø¨ Ø¨ÙŠØª', 'Ø¨Ø¬Ø§Ù†Ø¨ Ø²Ù‡Ø±Ø©']
                        },
                        correct: 1
                    },
                    {
                        text: { en: 'What color was the friend fish?', ar: 'Ù…Ø§ Ù„ÙˆÙ† Ø§Ù„Ø³Ù…ÙƒØ© Ø§Ù„ØµØ¯ÙŠÙ‚Ø©ØŸ' },
                        colorQuestion: 'fish2Color',
                        colorFeminine: true
                    },
                    {
                        text: { en: 'Where did the two fish play together?', ar: 'Ø£ÙŠÙ† Ù„Ø¹Ø¨Øª Ø§Ù„Ø³Ù…ÙƒØªØ§Ù† Ù…Ø¹Ø§Ù‹ØŸ' },
                        options: {
                            en: ['In the rock', 'In the sand', 'On the water', 'Under the tree'],
                            ar: ['ÙÙŠ Ø§Ù„ØµØ®Ø±Ø©', 'ÙÙŠ Ø§Ù„Ø±Ù…Ù„', 'ÙÙˆÙ‚ Ø§Ù„Ù…Ø§Ø¡', 'ØªØ­Øª Ø§Ù„Ø´Ø¬Ø±Ø©']
                        },
                        correct: 1
                    }
                ]
            },
            {
                id: 'kg_fruit',
                icon: 'ğŸŒ',
                title: {
                    en: 'The Fruit Snack',
                    ar: 'ÙˆØ¬Ø¨Ø© Ø§Ù„ÙØ§ÙƒÙ‡Ø©'
                },
                text: {
                    en: "Mom put a banana and an apple on Khaled's plate. Khaled ate the banana first, then he ate the apple. Khaled washed his hands with water and soap.",
                    ar: 'ÙˆØ¶Ø¹Øª Ù…Ø§Ù…Ø§ Ù…ÙˆØ²Ø© ÙˆØªÙØ§Ø­Ø© ÙÙŠ ØµØ­Ù† Ø®Ø§Ù„Ø¯. Ø£ÙƒÙ„ Ø®Ø§Ù„Ø¯ Ø§Ù„Ù…ÙˆØ²Ø© Ø£ÙˆÙ„Ø§Ù‹ Ø«Ù… Ø£ÙƒÙ„ Ø§Ù„ØªÙØ§Ø­Ø©. ØºØ³Ù„ Ø®Ø§Ù„Ø¯ ÙŠØ¯ÙŠÙ‡ Ø¨Ø§Ù„Ù…Ø§Ø¡ ÙˆØ§Ù„ØµØ§Ø¨ÙˆÙ†.'
                },
                questions: [
                    {
                        text: { en: 'What did Mom put on the plate?', ar: 'Ù…Ø§Ø°Ø§ ÙˆØ¶Ø¹Øª Ù…Ø§Ù…Ø§ ÙÙŠ Ø§Ù„ØµØ­Ù†ØŸ' },
                        options: {
                            en: ['Cake and cookies', 'Banana and apple', 'Orange and grapes', 'Bread and cheese'],
                            ar: ['ÙƒØ¹Ùƒ ÙˆØ¨Ø³ÙƒÙˆÙŠØª', 'Ù…ÙˆØ²Ø© ÙˆØªÙØ§Ø­Ø©', 'Ø¨Ø±ØªÙ‚Ø§Ù„ ÙˆØ¹Ù†Ø¨', 'Ø®Ø¨Ø² ÙˆØ¬Ø¨Ù†Ø©']
                        },
                        correct: 1
                    },
                    {
                        text: { en: 'Who ate the fruit?', ar: 'Ù…Ù† Ø§Ù„Ø°ÙŠ Ø£ÙƒÙ„ Ø§Ù„ÙØ§ÙƒÙ‡Ø©ØŸ' },
                        options: {
                            en: ['Mom', 'Dad', 'Khaled', 'Sister'],
                            ar: ['Ù…Ø§Ù…Ø§', 'Ø¨Ø§Ø¨Ø§', 'Ø®Ø§Ù„Ø¯', 'Ø§Ù„Ø£Ø®Øª']
                        },
                        correct: 2
                    },
                    {
                        text: { en: 'What did Khaled eat first?', ar: 'Ù…Ø§Ø°Ø§ Ø£ÙƒÙ„ Ø®Ø§Ù„Ø¯ Ø£ÙˆÙ„Ø§Ù‹ØŸ' },
                        options: {
                            en: ['Apple', 'Banana', 'Orange', 'Grapes'],
                            ar: ['Ø§Ù„ØªÙØ§Ø­Ø©', 'Ø§Ù„Ù…ÙˆØ²Ø©', 'Ø§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„', 'Ø§Ù„Ø¹Ù†Ø¨']
                        },
                        correct: 1
                    },
                    {
                        text: { en: 'What did Khaled wash his hands with?', ar: 'Ø¨Ù…Ø§Ø°Ø§ ØºØ³Ù„ Ø®Ø§Ù„Ø¯ ÙŠØ¯ÙŠÙ‡ØŸ' },
                        options: {
                            en: ['Just water', 'Water and soap', 'Juice', 'Milk'],
                            ar: ['Ù…Ø§Ø¡ ÙÙ‚Ø·', 'Ø§Ù„Ù…Ø§Ø¡ ÙˆØ§Ù„ØµØ§Ø¨ÙˆÙ†', 'Ø¹ØµÙŠØ±', 'Ø­Ù„ÙŠØ¨']
                        },
                        correct: 1
                    }
                ]
            },
            {
                id: 'kg_bird',
                icon: 'ğŸ¦',
                title: {
                    en: 'The Little Bird',
                    ar: 'Ø§Ù„Ø¹ØµÙÙˆØ± Ø§Ù„ØµØºÙŠØ±'
                },
                text: {
                    en: 'A beautiful bird stood on the window. The bird was singing a lovely tune. The bird flew to his nest on top of the palm tree. The bird put a feather in the nest.',
                    ar: 'ÙˆÙ‚Ù Ø¹ØµÙÙˆØ± Ø¬Ù…ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø§ÙØ°Ø©. ÙƒØ§Ù† Ø§Ù„Ø¹ØµÙÙˆØ± ÙŠØºÙ†ÙŠ Ù„Ø­Ù†Ø§Ù‹ Ù„Ø·ÙŠÙØ§Ù‹. Ø·Ø§Ø± Ø§Ù„Ø¹ØµÙÙˆØ± Ø¥Ù„Ù‰ Ø¹Ø´Ù‡ ÙÙˆÙ‚ Ø§Ù„Ù†Ø®Ù„Ø©. ÙˆØ¶Ø¹ Ø§Ù„Ø¹ØµÙÙˆØ± Ø±ÙŠØ´Ø© ÙÙŠ Ø§Ù„Ø¹Ø´.'
                },
                questions: [
                    {
                        text: { en: 'Where did the bird stand?', ar: 'Ø£ÙŠÙ† ÙˆÙ‚Ù Ø§Ù„Ø¹ØµÙÙˆØ±ØŸ' },
                        options: {
                            en: ['On the tree', 'On the window', 'On the ground', 'On the roof'],
                            ar: ['Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø¬Ø±Ø©', 'Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø§ÙØ°Ø©', 'Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¶', 'Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø·Ø­']
                        },
                        correct: 1
                    },
                    {
                        text: { en: 'What was the bird doing on the window?', ar: 'Ù…Ø§Ø°Ø§ ÙƒØ§Ù† ÙŠÙØ¹Ù„ Ø§Ù„Ø¹ØµÙÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø§ÙØ°Ø©ØŸ' },
                        options: {
                            en: ['Sleeping', 'Eating', 'Singing', 'Playing'],
                            ar: ['ÙŠÙ†Ø§Ù…', 'ÙŠØ£ÙƒÙ„', 'ÙŠØºÙ†ÙŠ', 'ÙŠÙ„Ø¹Ø¨']
                        },
                        correct: 2
                    },
                    {
                        text: { en: 'Where did the bird fly to?', ar: 'Ø¥Ù„Ù‰ Ø£ÙŠÙ† Ø·Ø§Ø± Ø§Ù„Ø¹ØµÙÙˆØ±ØŸ' },
                        options: {
                            en: ['To the garden', 'To his nest', 'To the house', 'To the sea'],
                            ar: ['Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø¯ÙŠÙ‚Ø©', 'Ø¥Ù„Ù‰ Ø¹Ø´Ù‡', 'Ø¥Ù„Ù‰ Ø§Ù„Ø¨ÙŠØª', 'Ø¥Ù„Ù‰ Ø§Ù„Ø¨Ø­Ø±']
                        },
                        correct: 1
                    },
                    {
                        text: { en: 'What did the bird put in the nest?', ar: 'Ù…Ø§Ø°Ø§ ÙˆØ¶Ø¹ Ø§Ù„Ø¹ØµÙÙˆØ± ÙÙŠ Ø§Ù„Ø¹Ø´ØŸ' },
                        options: {
                            en: ['A leaf', 'A feather', 'A flower', 'A stone'],
                            ar: ['ÙˆØ±Ù‚Ø©', 'Ø±ÙŠØ´Ø©', 'Ø²Ù‡Ø±Ø©', 'Ø­Ø¬Ø±']
                        },
                        correct: 1
                    }
                ]
            }
        ];
        
        // Get stories based on grade level
        function getStoriesForGrade() {
            const gradeLevel = GameUtils.getGradeLevel();
            return gradeLevel === 'kg' ? kgStories : stories;
        }
        
        // Game state
        let currentStory = null;
        let currentQuestionIndex = 0;
        let storyCorrectAnswers = 0;
        let totalScore = 0;
        let storiesCompleted = 0;
        let userAnswers = [];
        let storyScores = {};
        let readingTimer = null;
        let readingTimeLeft = 30;
        
        // Get current language
        function getLang() {
            return (typeof I18n !== 'undefined' && I18n.currentLang === 'ar') ? 'ar' : 'en';
        }
        
        // Initialize story selection
        function initStorySelect() {
            const storySelect = document.getElementById('storySelect');
            storySelect.innerHTML = '';
            
            const currentStories = getStoriesForGrade();
            document.getElementById('totalStories').textContent = currentStories.length;
            
            currentStories.forEach(story => {
                const card = document.createElement('div');
                card.className = 'story-card' + (storyScores[story.id] !== undefined ? ' completed' : '');
                card.innerHTML = `
                    <div class="story-icon">${story.icon}</div>
                    <div class="story-title">${story.title[getLang()]}</div>
                    ${storyScores[story.id] !== undefined ? `<div class="story-score">âœ“ ${storyScores[story.id]}/4</div>` : ''}
                `;
                card.onclick = () => selectStory(story);
                storySelect.appendChild(card);
            });
        }
        
        // Current story color assignments
        let currentColorMap = {};
        let currentColorTypes = {};  // Store semantic types for color questions
        
        // Current story number assignments
        let currentNumberMap = {};
        let currentNumberTypes = {};  // Store semantic types for number questions
        
        // Current story ordinal assignments
        let currentOrdinalMap = {};
        let currentOrdinalTypes = {};  // Store semantic types for ordinal questions
        
        // Process a story with random colors, numbers, and ordinals
        function processStoryWithColors(story) {
            // Deep clone the story first
            const processed = JSON.parse(JSON.stringify(story));
            
            // Reset maps
            currentColorMap = {};
            currentColorTypes = {};
            currentNumberMap = {};
            currentNumberTypes = {};
            currentOrdinalMap = {};
            currentOrdinalTypes = {};
            
            // Process color slots if any
            if (story.colorSlots && story.colorSlots.length > 0) {
                const usedColors = [];
                
                story.colorSlots.forEach(slot => {
                    const slotName = typeof slot === 'string' ? slot : slot.name;
                    const slotType = typeof slot === 'string' ? null : slot.type;
                    const allowedColors = slotType ? SEMANTIC_COLORS[slotType] : null;
                    
                    const color = getRandomColor(usedColors, allowedColors);
                    currentColorMap[slotName] = color;
                    currentColorTypes[slotName] = slotType;
                    usedColors.push(color);
                });
            }
            
            // Process number slots if any
            if (story.numberSlots && story.numberSlots.length > 0) {
                const usedNumbers = [];
                
                story.numberSlots.forEach(slot => {
                    const slotName = slot.name;
                    const slotType = slot.type;
                    const allowedNumbers = slotType ? SEMANTIC_NUMBERS[slotType] : null;
                    
                    const num = getRandomNumber(usedNumbers, allowedNumbers);
                    currentNumberMap[slotName] = num;
                    currentNumberTypes[slotName] = slotType;
                    usedNumbers.push(num);
                });
            }
            
            // Process ordinal slots if any
            if (story.ordinalSlots && story.ordinalSlots.length > 0) {
                const usedOrdinals = [];
                
                story.ordinalSlots.forEach(slot => {
                    const slotName = slot.name;
                    const slotType = slot.type;
                    const allowedOrdinals = slotType ? SEMANTIC_ORDINALS[slotType] : null;
                    
                    const ord = getRandomOrdinal(usedOrdinals, allowedOrdinals);
                    currentOrdinalMap[slotName] = ord;
                    currentOrdinalTypes[slotName] = slotType;
                    usedOrdinals.push(ord);
                });
            }
            
            // Apply colors, numbers, and ordinals to story text
            processed.text.en = applyColors(processed.text.en, currentColorMap, 'en');
            processed.text.ar = applyColors(processed.text.ar, currentColorMap, 'ar');
            processed.text.en = applyNumbers(processed.text.en, currentNumberMap, 'en');
            processed.text.ar = applyNumbers(processed.text.ar, currentNumberMap, 'ar');
            processed.text.en = applyOrdinals(processed.text.en, currentOrdinalMap, 'en');
            processed.text.ar = applyOrdinals(processed.text.ar, currentOrdinalMap, 'ar');
            
            // Process questions
            processed.questions = processed.questions.map(q => {
                const question = { ...q };
                
                // Apply colors, numbers, and ordinals to question text if it has placeholders
                if (question.text) {
                    let enText = applyColors(question.text.en, currentColorMap, 'en');
                    let arText = applyColors(question.text.ar, currentColorMap, 'ar');
                    enText = applyNumbers(enText, currentNumberMap, 'en');
                    arText = applyNumbers(arText, currentNumberMap, 'ar');
                    enText = applyOrdinals(enText, currentOrdinalMap, 'en');
                    arText = applyOrdinals(arText, currentOrdinalMap, 'ar');
                    question.text = { en: enText, ar: arText };
                }
                
                // If this is a color question, generate options dynamically
                if (question.colorQuestion) {
                    const correctColor = currentColorMap[question.colorQuestion];
                    const semanticType = currentColorTypes[question.colorQuestion];
                    const colorResult = generateColorOptions(correctColor, question.colorFeminine, semanticType);
                    question.options = colorResult.options;
                    question.correct = colorResult.correct;
                }
                // If this is a number question, generate options dynamically
                else if (question.numberQuestion) {
                    const correctNumber = currentNumberMap[question.numberQuestion];
                    const semanticType = currentNumberTypes[question.numberQuestion];
                    const numResult = generateNumberOptions(correctNumber, question.numberFeminine, semanticType);
                    question.options = numResult.options;
                    question.correct = numResult.correct;
                }
                // If this is an ordinal question, generate options dynamically
                else if (question.ordinalQuestion) {
                    const correctOrdinal = currentOrdinalMap[question.ordinalQuestion];
                    const semanticType = currentOrdinalTypes[question.ordinalQuestion];
                    const ordResult = generateOrdinalOptions(correctOrdinal, question.ordinalFeminine, semanticType);
                    question.options = ordResult.options;
                    question.correct = ordResult.correct;
                }
                // Apply colors, numbers, and ordinals to regular options if they have placeholders
                else if (question.options) {
                    question.options = {
                        en: question.options.en.map(opt => {
                            let result = applyColors(opt, currentColorMap, 'en');
                            result = applyNumbers(result, currentNumberMap, 'en');
                            return applyOrdinals(result, currentOrdinalMap, 'en');
                        }),
                        ar: question.options.ar.map(opt => {
                            let result = applyColors(opt, currentColorMap, 'ar');
                            result = applyNumbers(result, currentNumberMap, 'ar');
                            return applyOrdinals(result, currentOrdinalMap, 'ar');
                        })
                    };
                }
                
                return question;
            });
            
            return processed;
        }
        
        // Select a story
        function selectStory(story) {
            // Process story with random colors
            currentStory = processStoryWithColors(story);
            currentQuestionIndex = 0;
            storyCorrectAnswers = 0;
            userAnswers = [];
            
            showScreen('storyScreen');
            displayStory();
        }
        
        // Display story text
        function displayStory() {
            document.getElementById('storyName').textContent = currentStory.title[getLang()];
            document.getElementById('storyIconLarge').textContent = currentStory.icon;
            document.getElementById('storyText').textContent = currentStory.text[getLang()];
            
            // Start reading timer (shorter for KG stories)
            const gradeLevel = GameUtils.getGradeLevel();
            const maxTime = gradeLevel === 'kg' ? 20 : 30;
            readingTimeLeft = maxTime;
            updateTimerDisplay(maxTime);
            
            readingTimer = setInterval(() => {
                readingTimeLeft--;
                updateTimerDisplay(maxTime);
                
                if (readingTimeLeft <= 0) {
                    clearInterval(readingTimer);
                }
            }, 1000);
        }
        
        // Update timer display
        function updateTimerDisplay(maxTime = 30) {
            const progress = (readingTimeLeft / maxTime) * 100;
            document.getElementById('timerProgress').style.width = progress + '%';
            
            const timeText = typeof I18n !== 'undefined' 
                ? I18n.t('storyGame.timeLeft', { time: readingTimeLeft })
                : `${readingTimeLeft} seconds left`;
            document.getElementById('timerText').textContent = timeText;
        }
        
        // Ready button clicked
        document.getElementById('readyBtn').onclick = () => {
            clearInterval(readingTimer);
            showScreen('questionScreen');
            displayQuestion();
        };
        
        // Back from story button clicked
        document.getElementById('backFromStoryBtn').onclick = () => {
            clearInterval(readingTimer);
            showScreen('storySelectScreen');
        };
        
        // Display current question
        function displayQuestion() {
            const question = currentStory.questions[currentQuestionIndex];
            
            // Update progress dots
            const progressDiv = document.getElementById('questionProgress');
            progressDiv.innerHTML = '';
            currentStory.questions.forEach((q, i) => {
                const dot = document.createElement('div');
                dot.className = 'question-dot';
                if (i < currentQuestionIndex) {
                    dot.classList.add(userAnswers[i].correct ? 'answered' : 'wrong');
                } else if (i === currentQuestionIndex) {
                    dot.classList.add('current');
                }
                progressDiv.appendChild(dot);
            });
            
            // Display question
            document.getElementById('questionText').textContent = question.text[getLang()];
            
            // Display options
            const optionsDiv = document.getElementById('answerOptions');
            optionsDiv.innerHTML = '';
            
            question.options[getLang()].forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'answer-option';
                btn.textContent = option;
                btn.onclick = () => selectAnswer(index);
                optionsDiv.appendChild(btn);
            });
        }
        
        // Select an answer
        function selectAnswer(selectedIndex) {
            const question = currentStory.questions[currentQuestionIndex];
            const isCorrect = selectedIndex === question.correct;
            
            // Store user answer
            userAnswers.push({
                questionIndex: currentQuestionIndex,
                selected: selectedIndex,
                correct: isCorrect
            });
            
            if (isCorrect) {
                storyCorrectAnswers++;
                GameUtils.playSound('correct');
            } else {
                GameUtils.playSound('wrong');
            }
            
            // Highlight selected answer
            const options = document.querySelectorAll('.answer-option');
            options.forEach((opt, i) => {
                opt.style.pointerEvents = 'none';
                if (i === selectedIndex) {
                    opt.classList.add(isCorrect ? 'correct' : 'wrong');
                }
                if (i === question.correct && !isCorrect) {
                    setTimeout(() => opt.classList.add('show-correct'), 500);
                }
            });
            
            // Move to next question or results
            setTimeout(() => {
                currentQuestionIndex++;
                if (currentQuestionIndex < currentStory.questions.length) {
                    displayQuestion();
                } else {
                    showResults();
                }
            }, 1500);
        }
        
        // Show results
        function showResults() {
            showScreen('resultsScreen');
            
            // Update scores
            storyScores[currentStory.id] = storyCorrectAnswers;
            totalScore += storyCorrectAnswers * 25;
            storiesCompleted = Object.keys(storyScores).length;
            
            document.getElementById('totalScore').textContent = totalScore;
            document.getElementById('storiesCompleted').textContent = storiesCompleted;
            
            // Display score
            document.getElementById('scoreNumber').textContent = `${storyCorrectAnswers}/4`;
            
            // Set emoji and title based on score
            const emoji = storyCorrectAnswers === 4 ? 'ğŸ†' : 
                         storyCorrectAnswers >= 3 ? 'ğŸ‰' : 
                         storyCorrectAnswers >= 2 ? 'â­' : 'ğŸ’ª';
            document.getElementById('resultsEmoji').textContent = emoji;
            
            const titleKey = storyCorrectAnswers === 4 ? 'storyGame.perfect' :
                            storyCorrectAnswers >= 3 ? 'storyGame.greatJob' :
                            storyCorrectAnswers >= 2 ? 'storyGame.goodJob' : 'storyGame.keepTrying';
            const defaultTitle = storyCorrectAnswers === 4 ? 'Perfect! ğŸŒŸ' :
                                storyCorrectAnswers >= 3 ? 'Great Job!' :
                                storyCorrectAnswers >= 2 ? 'Good Job!' : 'Keep Trying!';
            document.getElementById('resultsTitle').textContent = 
                typeof I18n !== 'undefined' ? I18n.t(titleKey) : defaultTitle;
            
            // Build review list
            const reviewList = document.getElementById('reviewList');
            reviewList.innerHTML = '';
            
            currentStory.questions.forEach((question, index) => {
                const userAnswer = userAnswers[index];
                const isCorrect = userAnswer.correct;
                
                const item = document.createElement('div');
                item.className = 'review-item ' + (isCorrect ? 'correct' : 'wrong');
                
                const questionText = question.text[getLang()];
                const userAnswerText = question.options[getLang()][userAnswer.selected];
                const correctAnswerText = question.options[getLang()][question.correct];
                
                item.innerHTML = `
                    <div class="review-question">${index + 1}. ${questionText}</div>
                    <div class="review-answer user-answer">
                        <span class="icon">${isCorrect ? 'âœ“' : 'âœ—'}</span>
                        <span>${typeof I18n !== 'undefined' ? I18n.t('storyGame.yourAnswer') : 'Your answer'}: ${userAnswerText}</span>
                    </div>
                    ${!isCorrect ? `
                        <div class="review-answer correct-answer">
                            <span class="icon">âœ“</span>
                            <span>${typeof I18n !== 'undefined' ? I18n.t('storyGame.correctAnswer') : 'Correct'}: ${correctAnswerText}</span>
                        </div>
                    ` : ''}
                `;
                
                reviewList.appendChild(item);
            });
            
            // Save high score
            GameUtils.saveHighScore(GAME_KEY, totalScore, GameUtils.getPlayerName());
            loadHighScore();
            
            // Play sound based on score
            if (storyCorrectAnswers === 4) {
                GameUtils.playSound('levelUp');
            }
        }
        
        // Show specific screen
        function showScreen(screenId) {
            document.getElementById('storySelectScreen').classList.add('hidden');
            document.getElementById('storyScreen').classList.add('hidden');
            document.getElementById('questionScreen').classList.add('hidden');
            document.getElementById('resultsScreen').classList.add('hidden');
            document.getElementById(screenId).classList.remove('hidden');
        }
        
        // Next story button
        document.getElementById('nextStoryBtn').onclick = () => {
            // Find next incomplete story
            const currentStories = getStoriesForGrade();
            const nextStory = currentStories.find(s => storyScores[s.id] === undefined);
            if (nextStory) {
                selectStory(nextStory);
            } else {
                showScreen('storySelectScreen');
                initStorySelect();
            }
        };
        
        // Back to select button
        document.getElementById('backToSelectBtn').onclick = () => {
            showScreen('storySelectScreen');
            initStorySelect();
        };
        
        // Load high score
        function loadHighScore() {
            const saved = GameUtils.getHighScore(GAME_KEY);
            if (saved > 0) {
                const bestPlayer = GameUtils.getHighScorePlayerName(GAME_KEY);
                const highScoreText = typeof I18n !== 'undefined' 
                    ? I18n.t('game.highScorePoints', { score: saved, player: bestPlayer })
                    : `ğŸ† Best: ${saved} points by ${bestPlayer}`;
                document.getElementById('bestScoreDisplay').innerHTML = highScoreText;
            }
        }
        
        // Initialize
        GameUtils.initSoundToggle();
        loadHighScore();
        initStorySelect();
        
        // Listen for language changes
        window.addEventListener('languageChanged', () => {
            initStorySelect();
            if (currentStory && !document.getElementById('storySelectScreen').classList.contains('hidden')) {
                // Already on select screen, just refresh
            } else if (currentStory) {
                // Refresh current view
                displayStory();
            }
        });
    </script>
    <script>
        // Add language toggle button
        if (typeof I18n !== 'undefined') {
            const langBtn = I18n.createLanguageToggle();
            document.body.appendChild(langBtn);
        }
    </script>
</body>
</html>
