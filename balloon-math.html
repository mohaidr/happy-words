<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Balloon Pop Math üéà</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(180deg, #74b9ff 0%, #a29bfe 50%, #fd79a8 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            color: white;
            overflow: hidden;
        }
        
        h1 { margin-bottom: 8px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); white-space: nowrap; }
        
        .top-bar {
            width: 100%;
            max-width: 400px;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .home-btn {
            background: rgba(255,255,255,0.25);
            border: none;
            border-radius: 12px;
            padding: 8px 14px;
            font-size: 14px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            white-space: nowrap;
        }
        
        .home-btn:hover {
            background: rgba(255,255,255,0.4);
        }
        
        .stats {
            display: flex;
            gap: 25px;
            font-size: 20px;
            margin-bottom: 10px;
            background: rgba(0,0,0,0.2);
            padding: 10px 25px;
            border-radius: 20px;
        }
        
        .question-box {
            background: rgba(255,255,255,0.95);
            color: #2d3436;
            padding: 20px 40px;
            border-radius: 20px;
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        
        .question-box .hint {
            font-size: 16px;
            color: #636e72;
            font-weight: normal;
            margin-top: 5px;
        }
        
        #gameArea {
            width: 350px;
            height: 450px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .balloon {
            position: absolute;
            width: 60px;
            height: 75px;
            cursor: pointer;
            transition: transform 0.1s ease;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        .balloon:hover {
            transform: scale(1.1);
        }
        
        .balloon-body {
            width: 60px;
            height: 70px;
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            box-shadow: inset -5px -5px 15px rgba(0,0,0,0.2),
                        inset 5px 5px 15px rgba(255,255,255,0.3);
            position: relative;
        }
        
        .balloon-body::after {
            content: '‚ñº';
            position: absolute;
            bottom: -8px;
            font-size: 12px;
            color: inherit;
        }
        
        .balloon.red .balloon-body { background: linear-gradient(135deg, #ff6b6b, #ee5a5a); }
        .balloon.red .balloon-body::after { color: #ee5a5a; }
        
        .balloon.blue .balloon-body { background: linear-gradient(135deg, #74b9ff, #0984e3); }
        .balloon.blue .balloon-body::after { color: #0984e3; }
        
        .balloon.green .balloon-body { background: linear-gradient(135deg, #00b894, #00cec9); }
        .balloon.green .balloon-body::after { color: #00cec9; }
        
        .balloon.yellow .balloon-body { background: linear-gradient(135deg, #fdcb6e, #f39c12); }
        .balloon.yellow .balloon-body::after { color: #f39c12; }
        
        .balloon.purple .balloon-body { background: linear-gradient(135deg, #a29bfe, #6c5ce7); }
        .balloon.purple .balloon-body::after { color: #6c5ce7; }
        
        .balloon.pink .balloon-body { background: linear-gradient(135deg, #fd79a8, #e84393); }
        .balloon.pink .balloon-body::after { color: #e84393; }
        
        .balloon.popping {
            animation: pop 0.3s ease forwards;
        }
        
        .balloon.wrong-pop {
            animation: wrongPop 0.4s ease forwards;
        }
        
        @keyframes pop {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
            100% { transform: scale(0); opacity: 0; }
        }
        
        @keyframes wrongPop {
            0% { transform: scale(1); }
            25% { transform: scale(1.1) rotate(-5deg); }
            50% { transform: scale(0.9) rotate(5deg); }
            75% { transform: scale(1.05) rotate(-3deg); }
            100% { transform: scale(1); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(-2deg); }
            50% { transform: translateY(-10px) rotate(2deg); }
        }
        
        .floating {
            animation: float 2s ease-in-out infinite;
        }
        
        #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255,255,255,0.98);
            color: #2d3436;
            padding: 30px 40px;
            border-radius: 25px;
            text-align: center;
            display: none;
            z-index: 100;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        
        #gameOver h2 { color: #6c5ce7; margin-bottom: 15px; }
        #gameOver p { margin: 8px 0; font-size: 18px; }
        
        .home-link {
            display: block;
            margin-top: 15px;
            color: #999;
            text-decoration: none;
            font-size: 14px;
        }
        
        .home-link:hover {
            color: #6c5ce7;
        }
        
        .btn {
            margin-top: 15px;
            padding: 15px 35px;
            font-size: 18px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(145deg, #6c5ce7, #a29bfe);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(108, 92, 231, 0.4);
        }
        
        .streak {
            position: fixed;
            top: 20%;
            font-size: 48px;
            font-weight: bold;
            color: #fdcb6e;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            animation: streakPop 0.5s ease forwards;
            pointer-events: none;
        }
        
        @keyframes streakPop {
            0% { transform: scale(0) rotate(-10deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(5deg); opacity: 1; }
            100% { transform: scale(1) rotate(0deg) translateY(-20px); opacity: 0; }
        }
        
        .timer-bar {
            width: 350px;
            height: 8px;
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .timer-fill {
            height: 100%;
            background: linear-gradient(90deg, #00b894, #fdcb6e, #ff6b6b);
            border-radius: 4px;
            transition: width 0.1s linear;
        }
        
        .info { margin-top: 12px; opacity: 0.9; }
    </style>
</head>
<body>
    <div class="top-bar">
        <a href="index.html" class="home-btn">‚Üê Home</a>
        <h1>üéà Balloon Pop Math</h1>
    </div>
    
    <div class="stats">
        <div>Score: <span id="score">0</span></div>
        <div>Level: <span id="level">1</span></div>
        <div>üî• <span id="streak">0</span></div>
    </div>
    
    <div class="question-box">
        <div id="question">5 + 3 = ?</div>
        <div class="hint">Pop the correct answer!</div>
    </div>
    
    <div id="gameArea">
        <div id="gameOver">
            <h2>üéâ Time's Up!</h2>
            <p id="playerDisplay"></p>
            <p>Final Score: <span id="finalScore">0</span></p>
            <p>üèÜ High Score: <span id="highScore">0</span></p>
            <p>Questions Correct: <span id="correctCount">0</span></p>
            <button class="btn" onclick="startGame()">Play Again</button>
            <a href="index.html" class="home-link">‚Üê Back to Home</a>
        </div>
    </div>
    
    <div class="timer-bar">
        <div class="timer-fill" id="timerFill"></div>
    </div>
    
    <button class="btn" id="startBtn" onclick="startGame()">Start Game</button>
    <p class="info">Pop balloons with the correct answer before time runs out!</p>

    <script>
        let score = 0;
        let level = 1;
        let streak = 0;
        let bestStreak = 0;
        let correctCount = 0;
        let gameRunning = false;
        let timeLeft = 60;
        let maxTime = 60;
        let balloons = [];
        let currentAnswer = 0;
        let gameLoop;
        let timerLoop;
        
        // High score system
        const GAME_KEY = 'balloonMath';
        let highScore = parseInt(localStorage.getItem(GAME_KEY + '_highScore')) || 0;
        let playerName = localStorage.getItem('happyWordsPlayerName') || 'Player';
        let gradeLevel = localStorage.getItem('happyWordsGradeLevel') || 'kg';
        
        document.getElementById('highScore').textContent = highScore;
        
        const gameArea = document.getElementById('gameArea');
        const questionEl = document.getElementById('question');
        const scoreEl = document.getElementById('score');
        const levelEl = document.getElementById('level');
        const streakEl = document.getElementById('streak');
        const timerFill = document.getElementById('timerFill');
        const gameOverEl = document.getElementById('gameOver');
        const startBtn = document.getElementById('startBtn');
        
        const balloonColors = ['red', 'blue', 'green', 'yellow', 'purple', 'pink'];
        
        function generateQuestion() {
            let a, b, op, answer;
            
            // Adjust difficulty based on grade level
            if (gradeLevel === 'kg') {
                // KG: Simple addition/subtraction with small numbers
                a = Math.floor(Math.random() * 5) + 1;
                b = Math.floor(Math.random() * 5) + 1;
                if (level <= 3 || Math.random() < 0.7) {
                    op = '+';
                    answer = a + b;
                } else {
                    if (a < b) [a, b] = [b, a];
                    op = '-';
                    answer = a - b;
                }
            } else if (gradeLevel === 'g1-3') {
                // Grade 1-3: Addition, subtraction, intro to multiplication
                if (level <= 2) {
                    a = Math.floor(Math.random() * 10) + 1;
                    b = Math.floor(Math.random() * 10) + 1;
                    op = '+';
                    answer = a + b;
                } else if (level <= 4) {
                    if (Math.random() < 0.5) {
                        a = Math.floor(Math.random() * 15) + 1;
                        b = Math.floor(Math.random() * 15) + 1;
                        op = '+';
                        answer = a + b;
                    } else {
                        a = Math.floor(Math.random() * 15) + 5;
                        b = Math.floor(Math.random() * a);
                        op = '-';
                        answer = a - b;
                    }
                } else {
                    const rand = Math.random();
                    if (rand < 0.4) {
                        a = Math.floor(Math.random() * 20) + 1;
                        b = Math.floor(Math.random() * 20) + 1;
                        op = '+';
                        answer = a + b;
                    } else if (rand < 0.7) {
                        a = Math.floor(Math.random() * 20) + 5;
                        b = Math.floor(Math.random() * a);
                        op = '-';
                        answer = a - b;
                    } else {
                        a = Math.floor(Math.random() * 5) + 1;
                        b = Math.floor(Math.random() * 5) + 1;
                        op = '√ó';
                        answer = a * b;
                    }
                }
            } else {
                // Grade 3-6: All operations including multiplication and division
                if (level <= 2) {
                    a = Math.floor(Math.random() * 20) + 5;
                    b = Math.floor(Math.random() * 20) + 5;
                    op = Math.random() < 0.5 ? '+' : '-';
                    if (op === '-' && a < b) [a, b] = [b, a];
                    answer = op === '+' ? a + b : a - b;
                } else if (level <= 4) {
                    const rand = Math.random();
                    if (rand < 0.3) {
                        a = Math.floor(Math.random() * 50) + 10;
                        b = Math.floor(Math.random() * 30) + 1;
                        op = '+';
                        answer = a + b;
                    } else if (rand < 0.5) {
                        a = Math.floor(Math.random() * 50) + 20;
                        b = Math.floor(Math.random() * 30) + 1;
                        op = '-';
                        answer = a - b;
                    } else {
                        a = Math.floor(Math.random() * 10) + 1;
                        b = Math.floor(Math.random() * 10) + 1;
                        op = '√ó';
                        answer = a * b;
                    }
                } else {
                    const rand = Math.random();
                    if (rand < 0.25) {
                        a = Math.floor(Math.random() * 100) + 10;
                        b = Math.floor(Math.random() * 50) + 1;
                        op = '+';
                        answer = a + b;
                    } else if (rand < 0.45) {
                        a = Math.floor(Math.random() * 100) + 30;
                        b = Math.floor(Math.random() * 50) + 1;
                        op = '-';
                        answer = a - b;
                    } else if (rand < 0.75) {
                        a = Math.floor(Math.random() * 12) + 1;
                        b = Math.floor(Math.random() * 12) + 1;
                        op = '√ó';
                        answer = a * b;
                    } else {
                        b = Math.floor(Math.random() * 10) + 1;
                        answer = Math.floor(Math.random() * 10) + 1;
                        a = b * answer;
                        op = '√∑';
                    }
                }
            }
            
            currentAnswer = answer;
            questionEl.textContent = `${a} ${op} ${b} = ?`;
            
            // Clear old balloons
            balloons.forEach(b => b.el.remove());
            balloons = [];
            
            // Generate answer options
            const answers = [answer];
            while (answers.length < 5) {
                let wrong = answer + Math.floor(Math.random() * 11) - 5;
                if (wrong !== answer && wrong > 0 && !answers.includes(wrong)) {
                    answers.push(wrong);
                }
            }
            
            // Shuffle answers so correct answer appears in random position
            answers.sort(() => Math.random() - 0.5);
            
            // Create balloons with answers
            answers.forEach((ans, i) => {
                createBalloon(ans, i, answers.length);
            });
        }
        
        function createBalloon(value, index, total) {
            const balloon = document.createElement('div');
            const color = balloonColors[Math.floor(Math.random() * balloonColors.length)];
            balloon.className = `balloon ${color} floating`;
            
            const body = document.createElement('div');
            body.className = 'balloon-body';
            body.textContent = value;
            balloon.appendChild(body);
            
            // Grid-based positioning to prevent overlap
            const cols = 3;
            const rows = 2;
            const col = index % cols;
            const row = Math.floor(index / cols);
            
            const cellWidth = 280 / cols;
            const cellHeight = 350 / rows;
            
            // Position in grid cell with small random offset
            const x = col * cellWidth + 20 + (Math.random() * 30);
            const y = row * cellHeight + 40 + (Math.random() * 40);
            
            balloon.style.left = x + 'px';
            balloon.style.top = y + 'px';
            balloon.style.animationDelay = (Math.random() * 2) + 's';
            
            balloon.onclick = () => popBalloon(balloon, value);
            
            gameArea.appendChild(balloon);
            balloons.push({ el: balloon, value: value });
        }
        
        function popBalloon(balloon, value) {
            if (!gameRunning || balloon.classList.contains('popping')) return;
            
            if (value === currentAnswer) {
                // Correct!
                balloon.classList.add('popping');
                score += 10 + (streak * 2);
                streak++;
                correctCount++;
                
                if (streak > bestStreak) bestStreak = streak;
                
                scoreEl.textContent = score;
                streakEl.textContent = streak;
                
                // Show streak message
                if (streak >= 3 && streak % 3 === 0) {
                    showStreak(streak);
                }
                
                // Level up every 5 correct
                if (correctCount % 5 === 0) {
                    level++;
                    levelEl.textContent = level;
                    // Bonus time
                    timeLeft = Math.min(maxTime, timeLeft + 5);
                }
                
                setTimeout(() => {
                    generateQuestion();
                }, 300);
            } else {
                // Wrong!
                balloon.classList.add('wrong-pop');
                streak = 0;
                streakEl.textContent = streak;
                timeLeft = Math.max(0, timeLeft - 3);
                
                setTimeout(() => {
                    balloon.classList.remove('wrong-pop');
                }, 400);
            }
        }
        
        function showStreak(count) {
            const streakEl = document.createElement('div');
            streakEl.className = 'streak';
            streakEl.textContent = `üî• ${count} Streak!`;
            streakEl.style.left = '50%';
            streakEl.style.transform = 'translateX(-50%)';
            document.body.appendChild(streakEl);
            
            setTimeout(() => streakEl.remove(), 600);
        }
        
        function updateTimer() {
            timeLeft -= 0.1;
            const percent = (timeLeft / maxTime) * 100;
            timerFill.style.width = percent + '%';
            
            if (timeLeft <= 0) {
                endGame();
            }
        }
        
        function startGame() {
            score = 0;
            level = 1;
            streak = 0;
            bestStreak = 0;
            correctCount = 0;
            timeLeft = maxTime;
            gameRunning = true;
            
            scoreEl.textContent = '0';
            levelEl.textContent = '1';
            streakEl.textContent = '0';
            timerFill.style.width = '100%';
            gameOverEl.style.display = 'none';
            startBtn.style.display = 'none';
            
            generateQuestion();
            timerLoop = setInterval(updateTimer, 100);
        }
        
        function endGame() {
            gameRunning = false;
            clearInterval(timerLoop);
            
            // Save high score
            if (score > highScore) {
                highScore = score;
                localStorage.setItem(GAME_KEY + '_highScore', highScore);
                localStorage.setItem(GAME_KEY + '_playerName', playerName);
            }
            
            document.getElementById('finalScore').textContent = score;
            document.getElementById('highScore').textContent = highScore;
            document.getElementById('correctCount').textContent = correctCount;
            document.getElementById('playerDisplay').textContent = playerName + "'s Game";
            gameOverEl.style.display = 'block';
            startBtn.style.display = 'block';
        }
    </script>
</body>
</html>
